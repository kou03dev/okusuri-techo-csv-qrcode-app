<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <!-- https://codezine.jp/article/detail/10928 -->
  <meta name="viewport" content="width=device-width,initial-scale=1">
<!--
QRコード関連
https://onoredekaiketsu.com/create-qr-code-with-javascript/
OnChangeイベント関連
https://techacademy.jp/magazine/20723

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script> 

<script src="jquery-3.6.0.min.js"></script>
<script src="jquery.qrcode.min.js"></script>
<script src="encoding.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script> 

-->

<!--
ローカルに js を配置指定利用する場合の例)
<script src="./jquery-3.6.0.min.js"></script>
<script src="./jquery.qrcode.min.js"></script>
<script src="./encoding.js"></script>
-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js" integrity="sha512-n/4gHW3atM3QqRcbCn6ewmpxcLAHGaDjpEBu4xZd47N0W2oQ+6q7oc3PXstrJYXcbNU1OHdQ1T7pAP+gi5Yu8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js" integrity="sha512-NFUcDlm4V+a2sjPX7gREIXgCSFja9cHtKPOL1zj6QhnE0vcY695MODehqkaGYTLyL2wxe/wtr4Z49SvqXq12UQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.js" integrity="sha512-vaCo7tf//3zOfbhMkG2cwdcR4XGe8V6V9UEqLYaZ02WcW0QioesBenI0awCRCNVZqAo34uG3gUGxkOCoIjJYVQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js">

</script>
<script>
  class csvCheckResult {
    constructor(_linenbr, _recnbr, _resultcd, _resultstr) {
      this.linenbr = _linenbr ;
      this.recnbr = _recnbr ;
      this.resultcd = _resultcd ;
      this.resultstr = _resultstr ;
    }
  }
</script>
<script>
  class csvLineCheck {
    csvColMaxNbr_Check(curLineNbr, expectedVal, realVal) {
      this.chk_rslt_str = "" ;
      this.cl_red = 0;
      this.cl_green = 0;
      this.cl_blue = 0;
      if (expectedVal === realVal) {
        this.chk_rslt_str = "CSV列数チェック結果: OK (正常) (" + curLineNbr + " 行目) (CSV列数(期待値): " + expectedVal + " === CSV列数(実測値): " + realVal + ")" ;
        this.cl_red = 100;
        this.cl_green = 230;
        this.cl_blue = 230;
      } else if (expectedVal > realVal) {
        this.chk_rslt_str = "CSV列数チェック結果: NG (異常 error) (" + curLineNbr + " 行目) (CSV列数(期待値): " + expectedVal + " &gt; CSV列数(実測値): " + realVal + ")" ;
        this.cl_red = 230;
        this.cl_green = 200;
        this.cl_blue = 200;
      } else if (expectedVal < realVal) {
        this.chk_rslt_str = "CSV列数チェック結果: NG (異常 error) (" + curLineNbr + " 行目) (CSV列数(期待値): " + expectedVal + " &lt; CSV列数(実測値): " + realVal + ")" ;
        this.cl_red = 230;
        this.cl_green = 200;
        this.cl_blue = 200;
      } else {
        this.chk_rslt_str = "CSV列数チェック結果: NG (異常 error) (CSV列数(期待値): " + expectedVal + " (比較不可) CSV列数(実測値): " + realVal + ")" ;
        this.cl_red = 230;
        this.cl_green = 200;
        this.cl_blue = 200;
      }

//      return chk_rslt_str ;
    
    }
    getRecNbrInfo(recnbr) {
      if ( recnbr.length > 0) {
        switch (recnbr) {
        case "1":  //  1 患者情報レコード
          this.maxColLimit = 10;
          this.recnm_jp = "患者情報レコード" ;
          break;
        case "5":  //  5 調剤年月日レコード
          this.maxColLimit = 2;
          this.recnm_jp = "調剤年月日レコード" ;
          break;
        case "11":  //  11 調剤－医療機関等レコード
          this.maxColLimit = 8;
          this.recnm_jp = "調剤－医療機関等レコード" ;
          break;
        case "15":  //  15 調剤－医師・薬剤師レコード
          this.maxColLimit = 3;
          this.recnm_jp = "調剤－医師・薬剤師レコード" ;
          break;
        case "51":  //  51 処方－医療機関レコード
          this.maxColLimit = 5;
          this.recnm_jp = "処方－医療機関レコード" ;
          break;
        case "55":  //  55 処方－医師レコード
          this.maxColLimit = 3;
          this.recnm_jp = "処方－医師レコード" ;
          break;
        case "201": // 201 薬品レコード
          this.maxColLimit = 7;
          this.recnm_jp = "薬品レコード" ;
          break;
        case "281": // 281 薬品補足レコード
          this.maxColLimit = 3;
          this.recnm_jp = "薬品レコード" ;
          break;
        case "291": // 291 薬品服用注意レコード
          this.maxColLimit = 3;
          this.recnm_jp = "薬品服用注意レコード" ;
          break;
        case "301": // 301 用法レコード
          this.maxColLimit = 8;
          this.recnm_jp = "用法レコード" ;
          break;
        case "311": // 311 用法補足レコード
          this.maxColLimit = 3;
          this.recnm_jp = "用法補足レコード" ;
          break;
        case "391": // 391 所要服用注意レコード
          this.maxColLimit = 3;
          this.recnm_jp = "所要服用注意レコード" ;
          break;
        case "401": // 401 服用注意レコード
          this.maxColLimit = 2;
          this.recnm_jp = "服用注意レコード" ;
          break;
        case "411": // 411 医療機関等提供情報
          this.maxColLimit = 3;
          this.recnm_jp = "医療機関等提供情報" ;
          break;
        case "421": // 421 残薬確認レコード
          this.maxColLimit = 2;
          this.recnm_jp = "残薬確認レコード" ;
          break;
        case "501": // 501 備考レコード
          this.maxColLimit = 2;
          this.recnm_jp = "備考レコード" ;
          break;
        case "601": // 601 患者等記入レコード
          this.maxColLimit = 2;
          this.recnm_jp = "患者等記入レコード" ;
          break;
        case "701": // 701 かかりつけ薬剤師レコード
          this.maxColLimit = 6;
          this.recnm_jp = "かかりつけ薬剤師レコード" ;
          break;
        default:
            const varrec_const = "JAHISTC";
            regex = new RegExp(varrec_const);
            if (regex.test($(this).val()) == true) {
              this.maxColLimit = 1;
              this.recnm_jp = "バージョンレコード" ;
            } else {
              this.maxColLimit = 10;
              this.recnm_jp = "バージョンレコード" ;
            }
            /*
            maxColIdx = 1;
            break;
            */
          }
  
      }
    }
  }
</script>
    
      
<style>
<!-- 
https://mae.chab.in/archives/2146
-->


#medicine_info_table {
  width: 100%;
  font-size: 14px;
  border-collapse: collapse;
}

#medicine_info_table th,
#medicine_info_table td {
  border: 1px solid #ccc;
  padding: 12px 8px;
  text-align: center;
}

#medicine_info_table th {
  background-color: #ad1457;
  color: #fff;
}

#medicine_info_table input,
#medicine_info_table select {
  width: 100px;
  cursor: pointer;
}

#medicine_info_table i {
  font-size: 18px;
  color: #7cb342;
}

#medicine_info_table input[type='button'] {
  background-color: #f0f0f0;
  border: 1px solid #aaa;
  border-radius: 2px;
  box-shadow: 0 1px 2px #999;
  font-size: 14px;
}

#medicine_info-tbody tr:first-child {
  display: none;
}

</style>

<title>お薬手帳CSVファイル・QRコードアプリ</title>
</head>

<script language="javascript" type="text/javascript">
  function test100() {
//    var test_str = "http://www.google.co.jp";
    var test_str = document.getElementById("test100val");
    var html_str2 = '<div id="test100-idimg-qr300"></div>\n'
    document.getElementById("test100output").innerHTML = html_str2;
    $("#test100-idimg-qr300").qrcode({width:200,height:200,text:test_str});
  }
  </script>



<body>
  <h1>お薬手帳CSVファイル・QRコード作成アプリ (ver 20230412 _123000)</h1>
  <h2>1. このアプリについて</h2>
  <p>このお薬手帳CSVファイル・QRコード作成アプリは、お薬手帳用の CSV ファイルや QR コードを作成・表示するためのアプリです。</p>
  <h2>1-2. このアプリの利用上の注意点 (概要)</h2>
    <ol>
      <li>このアプリのライセンスは、(準コピーレフト型ライセンスの一種である) Mozilla Public License (MPL) とします。
        <ol>
          <li>再配布の際は、著作権表示を残す必要があります。</li>
          <li>無保証です。</li>
        </ol>
      </li>
    </ol>
    <h2>1-3. このアプリの利用上の注意点 (詳細1)</h2>
    <ol>
      <li>このアプリは、商用・私用いずれの用途にも利用可能です。</li>
    </ol>
    <h2>1-4. このアプリの利用上の注意点 (詳細2)</h2>
    <ol>
      <li>このお薬手帳CSVファイル・QRコード作成アプリ (以下当アプリとする) に関して、当アプリは開発者がお薬手帳CSVのデバッグを行うことを目的としており、開発者以外の方が利用することは想定していません。</li>
      <li>当アプリに関してサポート契約を結んでいないにも関わらずにお薬手帳関連の関係者へサポートを求める、あるいは強要することを禁止します (具体的には以下を含みます)。
        <ol>
          <li>当アプリを利用している際に不明な点がある場合に、当アプリの製作者や当アプリの他の利用者に問い合わせを行い、期限付きで何らかの対処や回答を行うように強要すること
            <p>当アプリ製作者や利用者に問い合わせを行うこと自体は禁止ではありません。ただし期限付きで対処や回答を強要することは禁止します。また当アプリ製作者や他の利用者は本業を優先としていて、当アプリの制作はボランティアベースで行っています。</p>
          </li>
          <li>当アプリを利用している際に不明な点がある場合に、処方箋発行の医療機関に問い合わせを行うことおよび、何らかの対処や回答を行うように強要すること
            <p>当アプリに関して、処方箋発行の医療機関に問い合わせを行うこと自体を固く禁止します (当アプリ利用者は処方箋発行の医療機関との間に当アプリに関するサポート契約を当アプリ両社との間に締結していないため)。当然、対処や回答を求めることも禁止します。もし問い合わせ・対処・回答を求めていることが発覚した場合は、当アプリの公開を終了する場合があります。</p>
          </li>
          <li>当アプリを利用している際に不明な点がある場合に、調剤薬局・ドラッグストアに問い合わせを行うことおよび、何らかの対処や回答を行うように強要すること
            <p>当アプリに関して、調剤薬局・ドラッグストアに問い合わせを行うこと自体を固く禁止します (当アプリ利用者は調剤薬局・ドラッグストアとの間に当アプリに関するサポート契約を当アプリ両社との間に締結していないため)。当然、対処や回答を求めることも禁止します。もし問い合わせ・対処・回答を求めていることが発覚した場合は、当アプリの公開を終了する場合があります。</p>
          </li>
          <li>当アプリを利用している際に不明な点がある場合に、スマホの電子お薬手帳アプリの開発元に問い合わせを行うことおよび、何らかの対処や回答を行うように強要すること
            <p>当アプリに関して、スマホの電子お薬手帳アプリの開発元に問い合わせを行うこと自体を固く禁止します (当アプリ利用者はスマホの電子お薬手帳アプリの開発元との間に当アプリに関するサポート契約を当アプリ両社との間に締結していないため)。当然、対処や回答を求めることも禁止します。もし問い合わせ・対処・回答を求めていることが発覚した場合は、当アプリの公開を終了する場合があります。</p>
          </li>
        </ol>
      </li>
    </ol>
  <h2>1-5. 改訂履歴</h2>
  <table border="1" cellspacing="0">
    <tr>
      <tr><th>バージョン番号</th><th>公開日</th><th>変更点</th></tr>
      <tr>
        <td>20230412 _123000</td>
        <td>2023/04/12</td>
        <td>
        K群のお薬手帳用 QR コード作成機能を追加<br>
        </td>
      </tr>
      <tr>
        <td>20221007 _120000</td>
        <td>2022/10/07</td>
        <td>
        「311 (用法補足レコード)、391 (処方服用注意レコード)」に関して、以下の処理を追加<br>
        <br>
          一連のまとまった<br>
          「301 (用法レコード (201 がある場合は必須))、311 (用法補足レコード (必須ではない))、<br>
          391 (処方服用注意レコード (必須ではない))」の中で 301 が一連の 3xx の中で末尾ではない場合 (つまり 311 や 391 がある場合)に、<br>
          余計に加算されている yoho_rec_cnt (301 の数) を -1 する。<br>
          <br>
        </td>
      </tr>
      <tr>
        <td>20221010 _203000</td>
        <td>2022/10/10</td>
        <td>
          ページ内リンクを追加し、Web アプリのページ内の縦スクロール操作の必要性を低減した。<br>
        </td>
      </tr>    
    </table>
    <h2>2. 注意点</h2>
    <ul>
      <li>一つの薬につき、281 は 2 行以内にとどめる必要あり。
        3 行以上ある場合、H 群のお薬手帳は、QR コード読み取りを終えて「登録しますか?」の画面で「はい」を押しても登録されず、カメラで 0/0 の画面が表示される。</li>
    </ul>

  <p>QRコードテスト</p>
  <input type="text" id="test100val" value="https://www.google.co.jp">
  <input type="button" value="入力された文字や URL を QR コードに変換して表示" onClick="test100()">
  <p id="test100output"></p>
  
<!--
  <input type="text" id="input_message" value="" onchange="func1()">
-->


<!--
https://wakalog.hatenadiary.jp/entry/2017/11/09/170122
【Javascript/HTML】テーブルの行追加・削除をボタンを押して動的に操作する
-->
  <script>
    // Web ページ読み込み時に、グローバル変数を初期化
    // var initializing
    var yoho_rec_cnt = 0 ;
    var yoho_hosoku_rec_cnt = 0;
    var fukuyo_chui_rec_cnt = 0;
    var adqt_rpnbr = yoho_rec_cnt + 1 ;
    var varrec_verinfo = "" ;
    var csvLineNbr = 1 ;
    var currentlinenbr = 1 ;
    var csv_check_result_arr = []  ;
    var csv_check_result_buf = "CSV行番号\tレコード番号\t確認結果コード\t確認結果文字列\n" ;
    var csv_check_ok_cnt = 0 ;
    var csv_check_ng_cnt = 0 ;
    var csv_rownbr = 0 ;
    var csv_recnbr = "" ;
  </script>
  <h2>2. ナビゲート</h2>
  <p><a href="#button_to_clear_existing_data">「3. この Web アプリ画面上で開いている、既存の CSV ファイル関連の情報をクリア (Web アプリ画面上に表示されているデータのみを削除します。あらかじめ保存済みの CSV ファイルの内容は一切変更・削除されません)」へ、ページ内ジャンプ</a></p>
<h2 id="button_to_clear_existing_data">3. この Web アプリ画面上で開いている、既存の CSV ファイル関連の情報をクリア (Web アプリ画面上に表示されているデータのみを削除します。あらかじめ保存済みの CSV ファイルの内容は一切変更・削除されません)</h2>

    <input type="button" id="confirm" value="画面内に入力済みの値をすべてクリア" /><br>
    <p><a href="#button_to_open_csvfile">「CSV を開くためのボタンのある個所」へ、ページ内ジャンプ</a></p>
   <script>
      $(function(){
        $("#confirm").click(function(){
          var result = $.confirm({
            'title'     : '入力済みの内容をすべてクリアしてもよろしいですか。',
            'message'   : 'jQuery.confirmで表現しています',
            'buttons'   : {
               OK: {
                   action: function() {
                      console.log("OK");

                  $('#inputfileresult').val("");  

                  $('input:text[class="rec_number"]').val("");  
                  $('input:text[class="rec_number"]').blur();
                  $('input:text[class="col02"]').val("");  
                  $('input:text[class="rpnbr"]').val("");  
                  $('input:text[class="col03"]').val("");  
                  $('input:text[class="col04"]').val("");  
                  $('input:text[class="col05"]').val("");  
                  $('input:text[class="col06"]').val("");  
                  $('input:text[class="col07"]').val("");  
                  $('input:text[class="col08"]').val("");  
                  $('input:text[class="col09"]').val("");  
/*
// 1
        $('input:text[id="patientinfo_rec_rec_number"]').val("");
        $('input:text[id="patientinfo_rec_rec_number"]').blur();
        $('input:text[id="patientinfo_rec_patient_name_orgchar"]').val("");
        $('input:text[id="patientinfo_rec_patient_sex"]').val("");
        $('input:text[id="patientinfo_rec_patient_date_of_birth"]').val("");
        $('input:text[id="patientinfo_rec_patient_postalcode"]').val("");
        $('input:text[id="patientinfo_rec_patient_postaladdress"]').val("");
        $('input:text[id="patientinfo_rec_patient_phonenumber"]').val("");
        $('input:text[id="patientinfo_rec_patient_emergency_contact_information"]').val("");
        $('input:text[id="patientinfo_rec_patient_bloodtype"]').val("");
        $('input:text[id="patientinfo_rec_patient_weight"]').val("");
        $('input:text[id="patientinfo_rec_patientname_katakana"]').val("");
// 5
        $('input:text[id="dispensing_date_info_rec_rec_number"]').val("");
        $('input:text[id="dispensing_date_info_rec_rec_number"]').blur();
        $('input:text[id="dispensing_date_info_rec_date_of_dispensing"]').val("");
        $('input:text[id="dispensing_date_info_rec_date_inputted_by"]').val("");
// 11
        $('input:text[id="dispensing_med_inst_info_rec_rec_number"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_rec_number"]').blur();
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_name"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_pref_cd"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_cd"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_postal_cd"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_postal_address"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_landline_phone_number"]').val("");
        $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_data_inputted_by"]').val("");
      // "15":
        $('input:text[id="dispensing_doctor_pharmacist_info_rec_rec_number"]').val("");
        $('input:text[id="dispensing_doctor_pharmacist_info_rec_rec_number"]').blur();
        $('input:text[id="dispensing_doctor_pharmacist_info_rec_fullname"]').val("");
        $('input:text[id="dispensing_doctor_pharmacist_info_rec_contact_address"]').val("");
        $('input:text[id="dispensing_doctor_pharmacist_info_rec_inputted_by"]').val("");
*/        
      // 「患者・薬局・薬剤師・医療機関・医師に関する情報」の textarea 内の文字をクリアする
//      $('#medicineinfo_part01').val("");
      // 「薬に関する情報」の textarea 内の文字をクリアする
      $('#textarea_medicineinfo_part02_type01').val("");
      $('#textarea_medicineinfo_part02_type03').val("");
      // 「結合CSVの出力先の textarea 内の文字をクリアする」
      $('#medicineinfo_type01_concatted').val("");
      $('#medicineinfo_type02_concatted').val("");
      $('#medicineinfo_type03_concatted').val("");
      $('#sjis_slice_text_data').val("");
      //document.getElementById("sjis_slice_text_data").innerHTML = "";

      /*
      // "51":
        $('input:text[id="prescription_medical_institutions_info_rec_rec_number"]').val("");
        $('input:text[id="prescription_medical_institutions_info_rec_rec_number"]').blur();
        $('input:text[id="prescription_medical_institutions_info_rec_name"]').val("");
        $('input:text[id="prescription_medical_institutions_info_rec_pref_cd"]').val("");
        $('input:text[id="prescription_medical_institutions_info_rec_points_tbl_cd"]').val("");
        $('input:text[id="prescription_medical_institutions_info_rec_medical_institutions_cd"]').val("");
        $('input:text[id="prescription_medical_institutions_info_rec_inputted_by"]').val("");
*/        
        // https://remotestance.com/blog/190/
        var trlen = $("table#medicine_info_table tbody").children().length;  // trlenに行数が入っています。
        console.log("最終行は「" + trlen + "」です");
        for (tblToClearRowIdx = trlen; tblToClearRowIdx > 2; tblToClearRowIdx--) {
          // http://vbnettips.blog.shinobi.jp/javascript/javascript%20jquery%E3%81%A7%20table%20%E3%81%AE_154
          // 最終行を削除
          $('table#medicine_info_table tbody tr:last-child').remove();
        }
/*
        // 最終行の 2 列目に「処方－医師レコード」、3 列目に「医師氏名」などが残っているのをクリアする。
        $('input:text[id="prescription_medical_institutions_info_rec_rec_number"]').val("");
        $('input:text[id="prescription_medical_institutions_info_rec_rec_number"]').blur();
*/
        // 分割された CSV、および QR コードの内容をクリアする。
        document.getElementById("lastoutput01").innerHTML = "";
        // エンコーディングをクリアする。
        document.getElementById("inputfile_encoding_info").innerHTML = "";
        // 入力元ファイル名をクリアする。
        document.getElementById("file1").value = "";
        document.getElementById("sjis_slice_text_data").value = "";

        var test_str = "";
//        var html_str2 = '<div id="test100-idimg-qr300"></div>\n'
        var html_str2 = ''
        document.getElementById("test100output").innerHTML = html_str2;
        $("#test100-idimg-qr300").qrcode({width:200,height:200,text:test_str});


        document.getElementById('autoinput_fnc_proc_status').innerHTML = "<p>(処理実行前)</p>"
        document.getElementById('concatcsv_genqr_proc_status').innerHTML = "<p>(処理実行前)</p>";
        document.getElementById('concatcsv_genqr_proc_status2').innerHTML = "<p>(処理実行前)</p>";


/*
          // バージョンレコードには「(バージョン情報) JAHISTC07」「(出力区分) 2」
          document.getElementById('verec_verinfo').value= "JAHISTC07";
          document.getElementById('verrec_outputtype').value = "2";
          document.getElementById('concatcsv_genqr_proc_status').innerHTML = "<p>(処理開始前)</p>";
*/          
          yoho_rec_cnt = 0 ;
          adqt_rpnbr = yoho_rec_cnt + 1 ;
          var yoho_hosoku_rec_cnt = 0;
          var fukuyo_chui_rec_cnt = 0;
          varrec_verinfo = "" ;
          csv_chk_result = [] ;
          csv_check_ok_cnt = 0 ;
          csv_check_ng_cnt = 0 ;
          csv_rownbr = 0 ;
          csv_recnbr = "" ;
          csv_check_result_buf = "CSV行番号\tレコード番号\t確認結果コード\t確認結果文字列\n"
          $('csv_check_result_textarea').val(csv_check_result_buf) ;
          document.getElementById("csv_check_result_textarea").value = "";
                      return true;
                    }
                },
               NO: {
                    btnClass: 'btn-blue',
                    keys: ['enter'],
                    action: function() {
                      console.log("NO");
                  }
                }
            }
          });
//        alert(result);
        });
      });
    </script>

<br>
<br>


<p>お薬手帳の CSV ファイルまたは CSV ファイルの内容が (メールの下書きや evernote などに) 保存済みでしょうか。</p>

<ol>
  <li>はい。CSV ファイルを保存してあります。
    <ol>
      <li>CSV ファイルを保存してある場合は、CSV ファイルのエンコーディングを選びます。
        <ol>
          <li><label><input type="radio" name="encoding_val" value="autodetect" checked>エンコーディング自動検出 (通常ほこちらを選んで下さい)</label></li>
          <li><label><input type="radio" name="encoding_val" value="sjis">Shift-JIS</label></li>
          <li><label><input type="radio" name="encoding_val" value="utf8">UTF-8</label></li>
        </ol>
      </li>
      <li id="button_to_open_csvfile">以下の「参照」ボタンを押して CSV ファイルを選択して「OK」を押すと、読み込みが行われてその内容がテキストエリア1に表示されます。
        <p><input type="file" id="file1" /></p>
        <br>
       <p><div id="navigator_menu_for_autoinput_start_button">「<a href="#start_to_autoinput_fnc">テキストエリア1 内の文字を、「表1. 調剤されたお薬一覧表」に自動入力</a>」へ、ページ内ジャンプ</p>
      </li>
    </ol>
  </li>
  <li>はい。CSV ファイルの内容が (メールの下書きや evernote などに) 保存済みです。
    <p>以下の「テキストエリア1」にコピーペーストして下さい。</p>
  </li>
</ol>


<p>テキストエリア1. お薬手帳の CSV ファイルの内容</p>
<p>読み込みの際のエンコーディング: <div id="inputfile_encoding_info"></div></p>
<textarea id="inputfileresult" cols="100" rows="10"></textarea>


<script>
/*
https://javascript.keicode.com/newjs/how-to-read-file-with-file-api.php
*/
window.addEventListener('load', () => {


  const f = document.getElementById('file1');
  f.addEventListener('change', evt => {
    let input = evt.target;
    if (input.files.length == 0) {
      console.log('No file selected');
      return;
    }
/*
    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      document.getElementById('inputfileresult').value = reader.result;
    };
    reader.readAsText(file);
*/    
    const file2 = input.files[0];
    console.log("file2 = " + file2);
    const reader2 = new FileReader();
    reader2.onload = (e) => {
//      console.log("e.target.result = " + JSON.stringify(e.target.result));
      var bytes = new Uint8Array(e.target.result);
      const detected = Encoding.detect(bytes);
//      console.log("bytes = " + JSON.stringify(bytes));

// https://www.javadrive.jp/javascript/form/index4.html
var encoding_val_elem = document.getElementsByName('encoding_val');
var encoding_val_elem_len = encoding_val_elem.length;
var checkValue = '';

for (let enc_idx = 0; enc_idx < encoding_val_elem_len; enc_idx++){
    if (encoding_val_elem.item(enc_idx).checked){
        checkValue = encoding_val_elem.item(enc_idx).value;
    }
}


      unicodeString = "Failed to detect character encoding. お薬手帳のファイルのエンコーディング自動検出に失敗しました。エンコーディング(SJIS) を選んでからお薬手帳ファイルを再び選択して開けるかを試してみてください。もし文字化けなどが発生する場合は、エンコーディング(UTF8) を選んでから再度ファイルを選択して開けるかを試してみてください。"
      var isUTF8 = Encoding.detect(bytes, 'UTF8');
      if (isUTF8) {
        console.log(`お薬手帳のファイルのエンコーディングは「UTF8」です`);
        document.getElementById('inputfile_encoding_info').innerHTML = "UTF8";
        var unicodeString = Encoding.convert(bytes, {
          to: 'UNICODE',
          from: 'UTF8',
          type: 'string' // 文字列で返るよう 'string' を指定
        });
      }
      var isSJIS = Encoding.detect(bytes, 'SJIS');
      if (isSJIS) {
        console.log(`お薬手帳のファイルのエンコーディングは「SJIS」です`);
        document.getElementById('inputfile_encoding_info').innerHTML = "SJIS";
        var unicodeString = Encoding.convert(bytes, {
          to: 'UNICODE',
          from: 'SJIS',
          type: 'string' // 文字列で返るよう 'string' を指定
        });
      }
      if ( checkValue == "sjis") {
        console.log(`お薬手帳のファイルのエンコーディングを「SJIS」とみなして、ファイルを読み込みます`);
        document.getElementById('inputfile_encoding_info').innerHTML = "SJIS";
        var unicodeString = Encoding.convert(bytes, {
          to: 'UNICODE',
          from: 'SJIS',
          type: 'string' // 文字列で返るよう 'string' を指定
        });
      }
      if ( checkValue == "utf8") {
        console.log(`お薬手帳のファイルのエンコーディングを「UTF-8」とみなして、ファイルを読み込みます`);
        document.getElementById('inputfile_encoding_info').innerHTML = "UTF8";
        var unicodeString = Encoding.convert(bytes, {
          to: 'UNICODE',
          from: 'UTF8',
          type: 'string' // 文字列で返るよう 'string' を指定
        });
      }
      document.getElementById('inputfileresult').value = unicodeString;
      console.log(unicodeString);
  //      document.getElementById('inputfileresult').value = reader.result;
    };
    reader2.readAsArrayBuffer(file2);
//    console.log("file2 = " + JSON.stringify(file2));
  });
});

</script>



<script>
  function csvColMaxNbr_Check(curLineNbr, expectedVal, realVal) {
  var chk_rslt_str = "" ;
  cl_red = 0;
  cl_green = 0;
  cl_blue = 0;
  if (expectedVal === realVal) {
    chk_rslt_str = "CSV列数チェック結果: OK (正常) (" + curLineNbr + " 行目) (CSV列数(期待値): " + expectedVal + " === CSV列数(実測値): " + realVal + ")" ;
  } else if (expectedVal > realVal) {
    chk_rslt_str = "CSV列数チェック結果: NG (異常 error) (" + curLineNbr + " 行目) (CSV列数(期待値): " + expectedVal + " &gt; CSV列数(実測値): " + realVal + ")" ;
    cl_red = 233;
    cl_green = 200;
    cl_blue = 200;
  } else if (expectedVal < realVal) {
    chk_rslt_str = "CSV列数チェック結果: NG (異常 error) (" + curLineNbr + " 行目) (CSV列数(期待値): " + expectedVal + " &lt; CSV列数(実測値): " + realVal + ")" ;
  } else {
    chk_rslt_str = "CSV列数チェック結果: NG (異常 error) (CSV列数(期待値): " + expectedVal + " (比較不可) CSV列数(実測値): " + realVal + ")" ;
  }

  return chk_rslt_str ;

}
</script>

<script>
  function csvColMaxNbrExpectedVal_Get(recnbr) {

      if ( recnbr.length <= 0) {
        maxColLimit = -1 ;
      } else {
        switch (recnbr) {
        case "1":  //  1 患者情報レコード
          maxColLimit = 10;
          break;
        case "5":  //  5 調剤年月日レコード
          maxColLimit = 2;
          break;
        case "11":  //  11 調剤－医療機関等レコード
          maxColLimit = 8;
          break;
        case "15":  //  15 調剤－医師・薬剤師レコード
          maxColLimit = 3;
          break;
        case "51":  //  51 処方－医療機関レコード
          maxColLimit = 5;
          break;
        case "55":  //  55 処方－医師レコード
          maxColLimit = 3;
          break;
        case "201": // 201 薬品レコード
          maxColLimit = 7;
          break;
        case "281": // 281 薬品補足レコード
          maxColLimit = 3;
          break;
        case "291": // 291 薬品服用注意レコード
          maxColLimit = 3;
          break;
        case "301": // 301 用法レコード
          maxColLimit = 8;
          break;
        case "311": // 311 用法補足レコード
          maxColLimit = 3;
          break;
        case "391": // 391 所要服用注意レコード
          maxColLimit = 3;
          break;
        case "401": // 401 服用注意レコード
          maxColLimit = 2;
          break;
        case "411": // 411 医療機関等提供情報
          maxColLimit = 3;
          break;
        case "421": // 421 残薬確認レコード
          maxColLimit = 2;
          break;
        case "501": // 501 備考レコード
          maxColLimit = 2;
          break;
        case "601": // 601 患者等記入レコード
          maxColLimit = 2;
          break;
        case "701": // 701 かかりつけ薬剤師レコード
          maxColLimit = 6;
          break;
        default:
            const varrec_const = "JAHISTC";
            regex = new RegExp(varrec_const);
            if (regex.test($(this).val()) == true) {
              maxColLimit = 1;
            } else {
              maxColLimit = 10;
            }
        }
      }

    return maxColLimit ;
  }
</script>





<script>
  // https://stackoverflow.com/questions/13484496/how-can-i-get-an-elements-innerhtml-to-update-immediately
  function autoinput_fnc_performInitialHtmlRender() {
    /// This sets the innerHtml that you want the user to see
    /// While you are performing the calculations
    document.getElementById('autoinput_fnc_proc_status').innerHTML = "<p>処理実行中。しばらくお待ちください…</p>";
  }
</script>

<script>
  // https://stackoverflow.com/questions/13484496/how-can-i-get-an-elements-innerhtml-to-update-immediately
  function autoinput_fnc_performExpensiveCalculationsAndRender() {
      // This is the really expensive function that
      // you want to run once the browser has rendered 
      // the initial HTML
      var infilebufarr = [] ;
    infilebufarr = getArrFromTextarea('inputfileresult');

    $('input:text[class="rec_number"]').val("");  

    // var csvChk = new csvcheck();

    csvLineNbr = 1;
  //  for( var rowIdx =1,l=infilebufarr.length;rowIdx <l;rowIdx ++ ){
    for( var rowIdx =0,l=infilebufarr.length;rowIdx < l;rowIdx ++ ){
    
      csvLineNbr = rowIdx + 1 ;
      currentlinenbr = rowIdx + 1 ;
      csv_rownbr = rowIdx + 1 ;

      //    console.log(infilebufarr[rowIdx]);
    
      var tr = $("table#medicine_info_table tr");//テーブルの全行を取得
      
      var trmax = tr.length;
  //    console.log("tr.length = " + tr.length);

      var cells = $('tr:last');//最終行の列を取得(th、td)
  //    console.log("cells = " + JSON.stringify(cells));
  //    console.log("cells.eq(0).val() = " + cells.eq(0).val());
  //    console.log('cells.eq(0).find("rec_number").val() = ' + cells.eq(0).find("rec_number").val());
  //    console.log("$(\'input:text[class=\"rec_number\"]\').val()=" +  $('input:text[class="rec_number"]').val());
      
  /*    
      var cells = tr.eq(trmax).children();//1行目から順番に列を取得(th、td)
      console.log("cells = " + JSON.stringify(cells));
      console.log("cells.eq(0).val() = " + cells.eq(0).val());
      console.log('cells.eq(0).find("rec_number").val() = ' + cells.eq(0).find("rec_number").val());
  */

      /* ★★ */
      var colarr = infilebufarr[rowIdx].split(',');


      //$('input:text[class="rec_number"]').val(colarr[0])
      //if (cells.eq(0).find("input").val().length > 0) {
  /*
      if ($('input:text[class="rec_number"]').val().length > 0) {
        // + をクリックする。
        // cells.eq(12).find("input.addList").click;
        console.log("addList click");
        $('input:button[class="addList"]').trigger("click");
  //      $('#addList').trigger("click");
        var cells = tr.eq(trmax).children();//1行目から順番に列を取得(th、td)
      }
  */    
  //    medicine_info_rec_arr = ("55", "201", "281", "291", "301", "311", "391", "401", "411", "421", "501", "601", "701")
  /*
      if (colarr[0] == "55" || colarr[0] == "201" || colarr[0] == "281" || colarr[0] == "291" || colarr[0] == "301" || colarr[0] == "311" || colarr[0] == "391"  || colarr[0] == "401" || colarr[0] == "411" || colarr[0] == "421" || colarr[0] == "501" || colarr[0] == "601" || colarr[0] == "701") {
        if ($('table#medicine_info_table tr:last input:text[class="rec_number"]').val().length > 0) {
          // + をクリックする。
          // cells.eq(12).find("input.addList").click;
          console.log("addList click");
          $('input:button[class="addList"]').trigger("click");
  //      $('#addList').trigger("click");
          var cells = tr.eq(trmax).children();//1行目から順番に列を取得(th、td)
        }
      }
  */    
      // let csvChk = new csvCheck();

      // csvChk.getRecNbrInfo(colarr[0]) ;
      csv_recnbr = colarr[0] ;
      switch (colarr[0]) {
        case "1":
          // $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          // $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur() ;
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_name_orgchar"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_sex"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_date_of_birth"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_postalcode"]').val(colarr[4]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_postaladdress"]').val(colarr[5]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_phonenumber"]').val(colarr[6]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_emergency_contact_information"]').val(colarr[7]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_bloodtype"]').val(colarr[8]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patient_weight"]').val(colarr[9]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patientname_katakana"]').val(colarr[10]);
          $('table#medicine_info_table tr:last input:text[class="patientinfo_rec_patientname_katakana"]').blur();
          // csvChk.getRecNbrInfo(colarr[0]) ;
          // csvChk.getRecNbrInfo(colarr[0]) ;
          $('table#medicine_info_table tr:last p[class="csvEachColChkSummaryStr"]').val("") ;
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "5":
          /*
          $('input:text[id="dispensing_date_info_rec_rec_number"]').val(colarr[0]);
          $('input:text[id="dispensing_date_info_rec_rec_number"]').blur();
          $('input:text[id="dispensing_date_info_rec_date_of_dispensing"]').val(colarr[1]);
          $('input:text[id="dispensing_date_info_rec_date_inputted_by"]').val(colarr[2]);
          break;
          */
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="dispensing_date_info_rec_date_of_dispensing"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "11":
  /*
          $('input:text[id="dispensing_med_inst_info_rec_rec_number"]').val(colarr[0]);
          $('input:text[id="dispensing_med_inst_info_rec_rec_number"]').blur();
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_name"]').val(colarr[1]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_pref_cd"]').val(colarr[2]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd"]').val(colarr[3]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_cd"]').val(colarr[4]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_postal_cd"]').val(colarr[5]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_postal_address"]').val(colarr[6]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_landline_phone_number"]').val(colarr[7]);
          $('input:text[id="dispensing_med_inst_info_rec_medical_institutions_data_inputted_by"]').val(colarr[8]);
          break;
  */
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_name"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_pref_cd"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_cd"]').val(colarr[4]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_postal_cd"]').val(colarr[5]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_postal_address"]').val(colarr[6]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_med_inst_info_rec_medical_institutions_landline_phone_number"]').val(colarr[7]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[8]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "15":
  /*
          $('input:text[id="dispensing_doctor_pharmacist_info_rec_rec_number"]').val(colarr[0]);
          $('input:text[id="dispensing_doctor_pharmacist_info_rec_rec_number"]').blur();
          $('input:text[id="dispensing_doctor_pharmacist_info_rec_fullname"]').val(colarr[1]);
          $('input:text[id="dispensing_doctor_pharmacist_info_rec_contact_address"]').val(colarr[2]);
          $('input:text[id="dispensing_doctor_pharmacist_info_rec_inputted_by"]').val(colarr[3]);
          break;
  */
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="dispensing_doctor_pharmacist_info_rec_fullname"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="dispensing_doctor_pharmacist_info_rec_contact_address"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "51":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="prescription_medical_institutions_info_rec_name"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="prescription_medical_institutions_info_rec_pref_cd"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="prescription_medical_institutions_info_rec_points_tbl_cd"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="prescription_medical_institutions_info_rec_medical_institutions_cd"]').val(colarr[4]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[5]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "55":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col02"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "201":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').blur();
          // blur() によって、focusout イベントを発生させる。
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col04"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col05"]').val(colarr[4]);
          $('table#medicine_info_table tr:last input:text[class="col06"]').val(colarr[5]);
          $('table#medicine_info_table tr:last input:text[class="col07"]').val(colarr[6]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[7]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "281":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').blur();
          $('table#medicine_info_table tr:last input:text[class="drug_supplemental_info"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="drug_supplemental_info"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "291":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').blur();
          // blur() によって、focusout イベントを発生させる。
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "301":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col04"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col05"]').val(colarr[4]);
          $('table#medicine_info_table tr:last input:text[class="col06"]').val(colarr[5]);
          $('table#medicine_info_table tr:last input:text[class="col07"]').val(colarr[6]);
          $('table#medicine_info_table tr:last input:text[class="col08"]').val(colarr[7]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[8]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "311":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "391":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="rpnbr"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "401":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="toyakuzentai_chui"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "411":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col02"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "421":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col02"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "501":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col02"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "601":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col02"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        case "701":
          $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
          $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
          $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
          $('table#medicine_info_table tr:last input:text[class="col02"]').val(colarr[1]);
          $('table#medicine_info_table tr:last input:text[class="col03"]').val(colarr[2]);
          $('table#medicine_info_table tr:last input:text[class="col04"]').val(colarr[3]);
          $('table#medicine_info_table tr:last input:text[class="col05"]').val(colarr[4]);
          $('table#medicine_info_table tr:last input:text[class="col06"]').val(colarr[5]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').val(colarr[6]);
          $('table#medicine_info_table tr:last input:text[class="col_data_created_by"]').blur();
          var csvChk = new csvLineCheck();
          csvChk.getRecNbrInfo(colarr[0]);
          // getRecNbrInfo 関数で取得した ColMax は 0 オリジン (0 から数え始めた場合の最大値) であるため、+ 1 する。
          var csvColMaxLimitNbr_ExpecteddVal = parseInt(csvChk.maxColLimit + 1) ;
          var csvColMaxLimitNbr_RealdVal = parseInt(colarr.length) ;
          csvChk.csvColMaxNbr_Check(currentlinenbr, csvColMaxLimitNbr_ExpecteddVal, csvColMaxLimitNbr_RealdVal);
          var csvColMaxLimitNbr_ChkRslt = csvChk.chk_rslt_str ;
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrExpectedVal"]').text(csvColMaxLimitNbr_ExpecteddVal);
          $('table#medicine_info_table tr:last p[class="csvColMaxNbrRealVal"]').text(csvColMaxLimitNbr_RealdVal);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').text(csvColMaxLimitNbr_ChkRslt);
          $('table#medicine_info_table tr:last p[class="csvcolNbrChkRsltStr"]').css( {'background-color': "rgb(" + csvChk.cl_red + "," +  csvChk.cl_green + "," +  csvChk.cl_blue + ")" });
          $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
          break;
        default:
          const varrec_const = "JAHISTC";
          reg = new RegExp(varrec_const);
          if ( colarr[0].match(reg)) {

            $('table#medicine_info_table tr:last input:text[class="csvorglinenbr"]').val(csvLineNbr) ;
            $('table#medicine_info_table tr:last input:text[class="currentlinenbr"]').val(currentlinenbr) ;
            $('table#medicine_info_table tr:last input:text[class="rec_number"]').val(colarr[0]);
            $('table#medicine_info_table tr:last input:text[class="rec_number"]').blur();
            $('table#medicine_info_table tr:last input:text[class="verrec_outputtype"]').val(colarr[1]);
            $('table#medicine_info_table tr:last input:button[class="addList"]').trigger("click");
            // document.getElementById('verec_verinfo').val(colarr[0]);
            // document.getElementById('verrec_outputtype').val(colarr[1]);
          }
          break;
      }
    }
//    document.getElementById("csv_check_result_textarea").value = csv_check_result_buf;
    document.getElementById('autoinput_fnc_proc_status').innerHTML = "<p>表への自動入力が完了しました。下へスクロールして、表の内容をご確認ください。</p><p><a href='#csv_check_result'>「3-1-2. 入力されたデータのチェック結果」へジャンプ</a></p>";
//      const pre = document.getElementById('pre1');
//      pre.innerHTML = reader.result;
  }
</script>

<script>
function autoinput_fnc() {

  // https://stackoverflow.com/questions/13484496/how-can-i-get-an-elements-innerhtml-to-update-immediately
  autoinput_fnc_performInitialHtmlRender(); // showing "now procecing. please wait."
  setTimeout(autoinput_fnc_performExpensiveCalculationsAndRender(), 0);
  return;
}
</script>

<script>
function getArrFromTextarea (textareaid) {
    var text  = document.getElementById(textareaid).value.replace(/\r\n|\r/g, "\n");
    var lines = text.split( '\n' );
    var outArray = new Array();
 
    for ( var i = 0; i < lines.length; i++ ) {
        // 空行は無視する
        if ( lines[i] == '' ) {
            continue;
        }
 
        outArray.push( lines[i] );
    }
 
    return outArray;
}
</script>

<h3 id="start_to_autoinput_fnc">テキストエリア1 内の文字を、「表1. 調剤されたお薬一覧表」に自動入力</h3>

<input type="button" value="「表1. 調剤されたお薬一覧表」に自動入力" id="autoinputstart_btn" onclick="autoinput_fnc()">
<div id="autoinput_fnc_proc_status"></div>
<pre id="pre1"></pre>

<!--
http://nanoappli.com/blog/archives/655
-->


<!--
行を追加します<input type="button" value="行を追加" id="coladd" onclick="coladd()">
        
<table id="table" border="1">
<tr>
<td>
SAMPLE FOR TABLE-ROWADD
</td>
<td>
SAMPLE FOR TABLE-ROWDELETE
</td>
</tr>
</table>

-->

<!--

<h3>バージョンレコード</h3>
<table id="tblver" border="1" cellspacing="1">
<tr><th>No</th><th>レコード名称</th><th>項目名称</th><th>型</th><th>バイト</th><th>値</th><th>備考</th><tr>
<tr><td></td><td>バージョンレコード</td><td>バージョン情報</td><td>X</td><td>9</td><td><input type="text" id="verec_verinfo" value="JAHISTC07"></td><td>“JAHISTC”+(バージョン 半角数字) ※9 桁固定とするため、バージョンが1 桁の場合は「0」を付加することとする。</td></tr>
<tr><td></td><td>バージョンレコード</td><td>出力区分</td><td>X</td><td>9</td><td><input type="text" id="verrec_outputtype" value="2"></td>
<td>
<ol>
<li>医療機関・薬局から患者等に情報を提供する場合</li>
<li>患者等から医療機関・薬局に情報を提供する場合</li>
</ol>
</td></tr>
</table>

<h3>(レコードNo 1) 患者情報レコード</h3>
<table id="tbl_patientinfo_rec" border="1" cellspacing="1">
<tr><th>No</th><th>レコード名称</th><th>項目名称</th><th>型</th><th>バイト</th><th>値</th><th>備考</th><tr>
<tr><td>1</td><td>患者情報レコード</td><td>レコードNo</td><td>9</td><td>1</td><td><input type="text" id="patientinfo_rec_rec_number" value=""></td><td></td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者氏名</td><td>N</td><td>40</td><td><input type="text" id="patientinfo_rec_patient_name_orgchar" value=""></td><td>全角、半角の混在は不可
出来る限り姓と名の間に空白を1 桁入れて、それ以外の空白は詰めて記録<br>
※外国人の場合など姓と名の区別がない場合や、ミドルネームがある場合においては、この限りではなく、「空白なし」および「複数の空白」での記録も可とする。<br>
※患者氏名に外字が含まれる場合は、全てカナで記録する。</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者性別</td><td>9</td><td>1</td><td><input type="text" id="patientinfo_rec_patient_sex" value=""></td><td>1:男、2:女</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者生年月日</td><td>X</td><td>8</td><td><input type="text" id="patientinfo_rec_patient_date_of_birth" value=""></td><td>年月日 西暦：8 桁YYYYMMDD <br>
和暦:7 桁 GYYMMDD<br>
和暦の年号(G)は別表１「年号区分コード」を参照</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者郵便番号</td><td>X</td><td>8</td><td><input type="text" id="patientinfo_rec_patient_postalcode" value=""></td><td>患者住所の郵便番号。数字３桁目と４桁目の間を“-”（ハイフン）で区切る記録も可とする。</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者住所</td><td>X</td><td>800</td><td><input type="text" id="patientinfo_rec_patient_postaladdress" value=""></td><td>患者住所(全角半角混在可)</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者電話番号</td><td>X</td><td>13</td><td><input type="text" id="patientinfo_rec_patient_phonenumber" value=""></td><td>患者電話番号。市外局番、市内局番を“-”（ハイフン）で区切る記録も可とする。</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>緊急連絡先</td><td>X</td><td>800</td><td><input type="text" id="patientinfo_rec_patient_emergency_contact_information" value=""></td><td>緊急連絡先氏名、緊急連絡先住所、緊急連絡先電話番号等を記録(全角半角混在可)</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>血液型</td><td>N</td><td>20</td><td><input type="text" id="patientinfo_rec_patient_bloodtype" value=""></td><td>血液型(全角半角混在可)</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>体重</td><td>N</td><td>20</td><td><input type="text" id="patientinfo_rec_patient_weight" value=""></td><td>体重<br>
kg で記録<br>
整数3 桁+小数点+小数3 桁<br>
整数の前のZERO 及び小数の後のZERO は省略、小数ZERO なら小数点も省略、整数ZEROならZERO を1 桁残す<br>
最大桁数出力例：123.456<br>
整数のみ出力例：67<br>
小数のみ出力例：0.85<br>
混在出力例：23.4</td></tr>
<tr><td>1</td><td>患者情報レコード</td><td>患者氏名カナ</td><td>N</td><td>40</td><td><input type="text" id="patientinfo_rec_patientname_katakana" value=""></td><td>全角、半角、ひらがな、カタカナの混在は不可。<br>
出来る限り姓と名の間に空白を1 桁入れて、それ以外の空白は詰めて記録<br>
※外国人の場合など姓と名の区別がない場合や、ミドルネームがある場合においては、この限りではなく、「空白なし」および「複数の空白」での記録も可とする。</td></tr>
</table>


<h3>(レコードNo 5) 調剤年月日レコード</h3>
<table id="tbl_dispensing_date_info_rec" border="1" cellspacing="1">
<tr><th>No</th><th>レコード名称</th><th>項目名称</th><th>型</th><th>バイト</th><th>値</th><th>備考</th><tr>
<tr><td>5</td><td>調剤年月日レコード</td><td>レコードNo</td><td>X</td><td>8</td><td><input type="text" id="dispensing_date_info_rec_rec_number" value="5"></td><td><br>
<tr><td>5</td><td>調剤年月日レコード</td><td>調剤等年月日</td><td>X</td><td>8</td><td><input type="text" id="dispensing_date_info_rec_date_of_dispensing" value="20220414"></td><td>西暦:8 桁YYYYMMDD 和暦:7 桁GYYMMDD<br>
和暦の年号(G)は別表１「年号区分コード」を参照<br>
薬局で調剤を行い出力する場合は「調剤年月日」を記録し、医療機関で調剤を行い出力する場合は「処方年月日」を記録<br>
医薬品等の提供を行わずに、医療機関・薬局から患者等に情報を提供する場合には、情報提供を行った年月日を記録</td></tr>
<tr><td>5</td><td>調剤年月日レコード</td><td>レコード作成者</td><td>9</td><td>1</td><td><input type="text" id="dispensing_date_info_rec_date_inputted_by" value="2"></td><td>1:医療関係者、2:患者等、8:その他、9:
不明</td></tr>
</table>


<h3>(レコードNo 11) 調剤－医療機関等レコード</h3>
<table id="tbl_dispensing_med_inst_info_rec" border="1" cellspacing="1">
<tr><th>No</th><th>レコード名称</th><th>項目名称</th><th>入力必須か (医療機関等→患者等)</th><th>入力必須か (患者等→医療機関等)</th><th>型</th><th>バイト</th><th>値</th><th>備考</th><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>レコードNo</td><td>◎</td><td>◎</td><td>X</td><td>8</td><td><input type="text" id="dispensing_med_inst_info_rec_rec_number" value=""></td><td></td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関名称</td><td>◎</td><td>◎</td><td>N</td><td>120</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_name" value=""></td><td>医療機関または薬局名称（全角半角混在可）</td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関等都道府県</td><td>◎</td><td> </td><td>X</td><td>2</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_pref_cd" value=""></td><td>医療機関または薬局の所在する都道府県コ
ード（別表２）を記録</td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関等点数表</td><td>◎</td><td> </td><td>X</td><td>1</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd" value=""></td><td>医療機関が使用する点数表コードを記録（別表３ 1:医科、3:歯科、4:調剤）</td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関等コード（※１）</td><td>◎</td><td> </td><td>X</td><td>7</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_cd" value=""></td><td>定められた医療機関コードまたは薬局コードを記録 ※遡及指定申請中の場合は省略可とする。0 から開始される場合は省略せず、7 桁固定で記録 (参考) <a href="https://iryokikan.info/search/">医療機関情報検索</a></td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関等郵便番号</td><td> </td><td> </td><td>X</td><td>7</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_postal_cd" value=""></td><td>医療機関または薬局住所の郵便番号。数字３桁目と４桁目の間を“-”（ハイフン）で区切る記録も可とする。</td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関等住所</td><td> </td><td> </td><td>N</td><td>800</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_postal_address" value=""></td><td>医療機関または薬局の住所（全角半角混在可）</td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>医療機関等電話番号</td><td> </td><td> </td><td>X</td><td>13</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_landline_phone_number" value=""></td><td>医療機関または薬局の住所（全角半角混在可）</td><tr>
<tr><td>11</td><td>調剤－医療機関等レコード</td><td>レコード作成者</td><td> </td><td> </td><td>9</td><td>1</td><td><input type="text" id="dispensing_med_inst_info_rec_medical_institutions_data_inputted_by" value=""></td><td>1:医療関係者、2:患者等、8:その他、9:不明</td><tr>
</table>



<h3>(レコードNo 15) 調剤－医師・薬剤師レコード</h3>
<table id="tbl_dispensing_doctor_pharmacist_info_rec" border="1" cellspacing="1">
<tr><th>No</th><th>レコード名称</th><th>項目名称</th><th>型</th><th>バイト</th><th>値</th><th>備考</th><tr>
<tr><td>15</td><td>調剤－医師・薬剤師レコード</td><td>レコードNo</td><td>X</td><td>8</td><td><input type="text" id="dispensing_doctor_pharmacist_info_rec_rec_number" value=""></td><td><br>
<tr><td>15</td><td>調剤－医師・薬剤師レコード</td><td>調剤－医師・薬剤師レコード</td><td>N</td><td>40</td><td><input type="text" id="dispensing_doctor_pharmacist_info_rec_fullname" value=""></td><td>医師・薬剤師氏名(全角半角混在可)　出来る限り姓と名の間に空白を1 桁入れて、それ以外の空白は詰めて記録<br>
※実際に調剤を行った薬剤師（診療所等で薬剤師が調剤を行っていない場合は医師）を記録する。</td></tr>
<tr><td>15</td><td>調剤－医師・薬剤師レコード</td><td>医師・薬剤師連絡先</td><td>N</td><td>800</td><td><input type="text" id="dispensing_doctor_pharmacist_info_rec_contact_address" value=""></td><td>医師・薬剤師の連絡先を記録(全角半角混在
可)</td></tr>
<tr><td>15</td><td>調剤－医師・薬剤師レコード</td><td>レコード作成者</td><td>9</td><td>1</td><td><input type="text" id="dispensing_doctor_pharmacist_info_rec_inputted_by" value=""></td><td>1:医療関係者、2:患者等、8:その他、9:
不明</td></tr>
</table>
-->
<!--
<h3>(レコードNo 51) 処方－医療機関レコード</h3>
<table id="tbl_prescription_medical_institutions_info_rec" border="1" cellspacing="1">
<tr><th>No</th><th>レコード名称</th><th>項目名称</th><th>型</th><th>バイト</th><th>値</th><th>備考</th><tr>
<tr><td>51</td><td>処方－医療機関レコード</td><td>レコードNo</td><td>X</td><td>8</td><td><input type="text" id="prescription_medical_institutions_info_rec_rec_number" value="51"></td><td><br>
<tr><td>51</td><td>処方－医療機関レコード</td><td>医療機関名称</td><td>N</td><td>120</td><td><input type="text" id="prescription_medical_institutions_info_rec_name" value="新橋日比谷通りクリニック"></td><td>医療機関名称（全角半角混在可）</td></tr>
<tr><td>51</td><td>処方－医療機関レコード</td><td>医療機関都道府県</td><td>X</td><td>2</td><td><input type="text" id="prescription_medical_institutions_info_rec_pref_cd" value="13"></td><td>医療機関の所在する都道府県コード（別表２）を記録</td></tr>
<tr><td>51</td><td>処方－医療機関レコード</td><td>医療機関点数表</td><td>X</td><td>1</td><td><input type="text" id="prescription_medical_institutions_info_rec_points_tbl_cd" value="1"></td><td>医療機関が使用する点数表コードを記録（別表３ 1:医科、3:歯科）</td></tr>
<tr><td>51</td><td>処方－医療機関レコード</td><td>医療機関コード</td><td>X</td><td>7</td><td><input type="text" id="prescription_medical_institutions_info_rec_medical_institutions_cd" value="5823612"></td><td>医療機関について定められたコードを記録　※遡及指定申請中の場合は省略可とする。0 から開始される場合は省略せず、7 桁固定で記録</td></tr>
<tr><td>51</td><td>処方－医療機関レコード</td><td>レコード作成者</td><td>9</td><td>1</td><td><input type="text" id="prescription_medical_institutions_info_rec_inputted_by" value="2"></td><td>1:医療関係者、2:患者等、8:その他、9:不明</td></tr>
</table>
-->


<!-- 
https://mae.chab.in/archives/2146
-->

<p>表1. 調剤されたお薬一覧表</p>

<p><div id="medicine_info_table_genqr_proc_status"></div></p>

<table id="medicine_info_table">
  <thead>
    <tr>
      <th>CSVファイルのオリジナル行番号</th>
      <th>現在の行番号</th>
      <th>レコード番号</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>各列チェック結果</th>
      <th>列数チェック結果</th>
      <th>CSV列数(期待値)</th>
      <th>CSV列数(実測値)</th>
      <th>リスト順</th>
      <th>行の追加/削除</th>
    </tr>
  </thead>

  <tbody id="medicine_info-tbody">
    <tr>
      <td>
        CSVファイルのオリジナル行番号<br><div class="csvorglinenbr"></div>
      </td>
      <td>
        現在の行番号<br><br><div class="currentlinenbr"></div>
      </td>
      <td>
        レコード番号<br><input type="text" class="rec_number" value="">
      </td>
      <td>
        レコード種別      
      </td>
      <td>
        <input type="text" class="col02" value="">
      </td>
      <td>
        <input type="text" class="col03" value="">
      </td>
      <td>
        <input type="text" class="col04" value="">
      </td>
      <td>
        <input type="text" class="col05" value="">
      </td>
      <td>
        <input type="text" class="col06" value="">
      </td>
      <td>
        <input type="text" class="col07" value="">
      </td>
      <td>
        <input type="text" class="col08" value="">
      </td>
      <td>
        <input type="text" class="col09" value="">
      </td>
      <td>
      </td>
      <td>
      </td>
      <td>
        各列チェック結果<br>
      </td>
      <td>
        CSV列数(期待値)<br>
      </td>
      <td>
        CSV列数(実測値)<br>
      </td>
      <td>
        列数チェック結果<br>
      </td>
      <td class="class_listUpDown">リスト順<br>
        <button class="upList">⬆️上へ</button>　
        <button class="downList">⬇️下へ</button>
      </td>
      <td class="class_listAddRemore">行の追加/削除<br>
        <input value="+" type="button" class="addList" />　
        <input value="-" type="button" class="removeList" />
      </td>
    </tr>
  </tbody>
</table>






<script>
/*
  var yoho_rec_cnt = 0 ;
  var adqt_rpnbr = yoho_rec_cnt + 1 ;

*/
  
$(document).ready(function() {

  var rpnum = 1 ;


  // CSSで非表示にした1行目の行を複製し、その行の下に挿入
  $('#medicine_info-tbody>tr')
    .clone(true)
    .insertAfter($('#medicine_info-tbody>tr'));

  $(document).on('blur', '.rec_number', function() {
    switch ($(this).val()) {
      case "":
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().next().html("");
        $(this).parent().next().next().html("");
        $(this).parent().next().next().next().html("");
        $(this).parent().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().html("");
        break;
      case "1":
        //currentlinenbr
        // (レコードNo 1) 患者情報レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("患者情報レコード");
        $(this).parent().next().next().html("患者氏名<br>全角、半角の混在は不可<br>出来る限り姓と名の間に空白を1 桁入れて、それ以外の空白は詰めて記録<br>※外国人の場合など姓と名の区別がない場合や、ミドルネームがある場合においては、この限りではなく、「空白なし」および「複数の空白」での記録も可とする。<br>※患者氏名に外字が含まれる場合は、全てカナで記録する。" + '<input type="text" class="patientinfo_rec_patient_name_orgchar" value=""><div class="patientinfo_rec_patient_name_orgchar_chk_rslt"></div>');
        $(this).parent().next().next().next().html("患者性別<br>1:男、2:女" + '<input type="text" class="patientinfo_rec_patient_sex" value=""><div class="patientinfo_rec_patient_sex_chk_rslt"></div>');
        $(this).parent().next().next().next().next().html("患者生年月日<br>年月日 西暦：8 桁YYYYMMDD <br>和暦:7 桁 GYYMMDD<br>和暦の年号(G)は別表１「年号区分コード」を参照" + '<input type="text" class="patientinfo_rec_patient_date_of_birth" value=""><div class="patientinfo_rec_patient_date_of_birth_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().html("患者郵便番号<br>患者住所の郵便番号。数字３桁目と４桁目の間を“-”（ハイフン）で区切る記録も可とする。" + '<input type="text" class="patientinfo_rec_patient_postalcode" value=""><div class="patientinfo_rec_patient_postalcode_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().html("患者住所<br>患者住所(全角半角混在可)" + '<input type="text" class="patientinfo_rec_patient_postaladdress" value=""><div class="patientinfo_rec_patient_postaladdress_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().html("患者電話番号<br>患者電話番号。市外局番、市内局番を“-”（ハイフン）で区切る記録も可とする。" + '<input type="text" class="patientinfo_rec_patient_phonenumber" value=""><div class="patientinfo_rec_patient_phonenumber_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().html("緊急連絡先<br>緊急連絡先氏名、緊急連絡先住所、緊急連絡先電話番号等を記録(全角半角混在可)" + '<input type="text" class="patientinfo_rec_patient_emergency_contact_information" value=""><div class="patientinfo_rec_patient_emergency_contact_information_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().next().html("血液型<br>血液型(全角半角混在可)" + '<input type="text" class="patientinfo_rec_patient_bloodtype" value=""><div class="patientinfo_rec_patient_bloodtype_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().html("体重<br> kg で記録<br>整数3 桁+小数点+小数3 桁<br>整数の前のZERO 及び小数の後のZERO は省略、小数ZERO なら小数点も省略、整数ZEROならZERO を1 桁残す<br>最大桁数出力例：123.456<br>整数のみ出力例：67<br>小数のみ出力例：0.85<br>混在出力例：23.4" + '<input type="text" class="patientinfo_rec_patient_weight" value=""><div class="patientinfo_rec_patient_weight_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().html("患者氏名カナ<br>全角、半角、ひらがな、カタカナの混在は不可。<br>出来る限り姓と名の間に空白を1 桁入れて、それ以外の空白は詰めて記録<br>※外国人の場合など姓と名の区別がない場合や、ミドルネームがある場合においては、この限りではなく、「空白なし」および「複数の空白」での記録も可とする。" + '<input type="text" class="patientinfo_rec_patientname_katakana" value=""><div class="patientinfo_rec_patientname_katakana_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "5":
        // (レコードNo 5) 調剤年月日レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("調剤－調剤年月日レコード");
        $(this).parent().next().next().html("(調剤を行った) 調剤年月日<br>西暦:8 桁YYYYMMDD 和暦:7 桁GYYMMDD<br>和暦の年号(G)は別表１「年号区分コード」を参照<br>薬局で調剤を行い出力する場合は「調剤年月日」を記録し、医療機関で調剤を行い出力する場合は「処方年月日」を記録<br>医薬品等の提供を行わずに、医療機関・薬局から患者等に情報を提供する場合には、情報提供を行った年月日を記録" + '<input type="text" class="dispensing_date_info_rec_date_of_dispensing" value=""><div class="dispensing_date_info_rec_date_of_dispensing_chk_rslt"></div>');
        $(this).parent().next().next().next().html("レコード作成者<br>" + "レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "11":
        // (レコードNo 11) 調剤－医療機関等レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("調剤－医療機関レコード");
        $(this).parent().next().next().html("(調剤を行った) 医療機関名称<br>医療機関または薬局名称（全角半角混在可）" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_name" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_name_chk_rslt"></div>');
        $(this).parent().next().next().next().html("(調剤を行った) 医療機関等都道府県 (のコード) <br>医療機関または薬局の所在する都道府県コード（別表２）を記録" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_pref_cd" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_pref_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().html("(調剤を行った) 医療機関等点数表 <br>医療機関が使用する点数表コードを記録（別表３ 1:医科、3:歯科、4:調剤）" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().html("(調剤を行った) 医療機関等コード（※１） <br>定められた医療機関コードまたは薬局コードを記録<br>※遡及指定申請中の場合は省略可とする。<br> 0 から開始される場合は省略せず、7 桁固定で記録" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_cd" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().html("(調剤を行った) 医療機関等郵便番号<br>医療機関または薬局住所の郵便番号。数字３桁目と４桁目の間を“-”（ハイフン）で区切る記録も可とする。" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_postal_cd" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_postal_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().html("(調剤を行った) 医療機関等住所<br>医療機関または薬局の住所（全角半角混在可）" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_postal_address" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_postal_address_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().html("(調剤を行った) 医療機関等電話番号<br医療機関または薬局の電話番号<br>市外局番、市内局番を“-”（ハイフン）で区切る記録も可とする。" + '<input type="text" class="dispensing_med_inst_info_rec_medical_institutions_landline_phone_number" value=""><div class="dispensing_med_inst_info_rec_medical_institutions_postal_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().next().next().next().html("レコード作成者<br>" + "レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "15":
        // (レコードNo 15) 調剤－医師・薬剤師レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("調剤－医師・薬剤師レコード");
        $(this).parent().next().next().html("(調剤を行った) 医師・薬剤師氏名(全角半角混在可)<br>出来る限り姓と名の間に空白を 1 桁入れて、それ以外の空白は詰めて記録<br>※実際に調剤を行った薬剤師（診療所等で薬剤師が調剤を行っていない場合は医師）を記録する。" + '<input type="text" class="dispensing_doctor_pharmacist_info_rec_fullname" value=""><div class="prescription_medical_institutions_info_rec_name_chk_rslt"></div>');
        $(this).parent().next().next().next().html("(調剤を行った) 医師・薬剤師連絡先<br>医師・薬剤師の連絡先を記録(全角半角混在可)" + '<input type="text" class="dispensing_doctor_pharmacist_info_rec_contact_address" value=""><div class="dispensing_doctor_pharmacist_info_rec_contact_address_chk_rslt"></div>');
        $(this).parent().next().next().next().next().html("レコード作成者<br>" + "レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "51":
        // (レコードNo 51) 処方－医療機関レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("処方－医療機関レコード");
        $(this).parent().next().next().html("(処方を行った) 医療機関名称<br>" + '<input type="text" class="prescription_medical_institutions_info_rec_name" value=""><div class="prescription_medical_institutions_info_rec_name_chk_rslt"></div>');
        $(this).parent().next().next().next().html("(処方を行った) 医療機関都道府県<br>" + '<input type="text" class="prescription_medical_institutions_info_rec_pref_cd" value=""><div class="prescription_medical_institutions_info_rec_pref_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().html("(処方を行った) 医療機関点数表<br>" + '<input type="text" class="prescription_medical_institutions_info_rec_points_tbl_cd" value=""><div class="prescription_medical_institutions_info_rec_points_tbl_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().html("(処方を行った) 医療機関コード<br>" + '<input type="text" class="prescription_medical_institutions_info_rec_medical_institutions_cd" value=""><div class="prescription_medical_institutions_info_rec_medical_institutions_cd_chk_rslt"></div>');
        $(this).parent().next().next().next().next().next().next().html("レコード作成者<br>" + "レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "55":
        // 処方－医師レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + currentlinenbr + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("処方－医師レコード");
        $(this).parent().next().next().html("医師氏名<br>" + '<input type="text" class="col02" value="">');
        $(this).parent().next().next().next().html("診療科名<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("レコード作成者<br>" + "レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "201":
        // 薬品レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("薬品レコード");
        $(this).parent().next().next().html("RP番号<br>" + '<input type="text" class="rpnbr" value=""><br>(適切なRP番号は)<input type="text" class="adqt_rpnbr_val" value="' + adqt_rpnbr + '">」です<div class="rpnr_chk_rslt"></div>');
        $(this).parent().next().next().next().html("薬品名称<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("用量<br>" + '<input type="text" class="col04" value="">');
        $(this).parent().next().next().next().next().next().html("単位名<br>" + '<input type="text" class="col05" value="">');
        $(this).parent().next().next().next().next().next().next().html("薬品コード種別<br>" + '<input type="text" class="col06" value="">');
        $(this).parent().next().next().next().next().next().next().next().html("薬品コード<br>" + '<input type="text" class="col07" value="">');
        $(this).parent().next().next().next().next().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "281":
//        // 281 薬品補足レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("薬品補足レコード");
        $(this).parent().next().next().html("RP番号<br>" + '<input type="text" class="rpnbr" value=""><br>(適切なRP番号は)<input type="text" class="adqt_rpnbr_val" value="' + adqt_rpnbr + '">」です<div class="rpnr_chk_rslt"></div>');
        $(this).parent().next().next().next().html("薬品補足情報<wbr>薬品にかかる補足情報を出力<wbr>(全角半角混在可)<wbr>(半角100文字)<br>" + '<input type="text" class="drug_supplemental_info" value="">');
        $(this).parent().next().next().next().next().html("薬品補足情報の文字数チェック結果" + '<p class="drug_supplemental_info_chk_result"></p>');
//        $(this).parent().next().next().next().html("薬品補足情報<wbr>薬品にかかる補足情報を出力<wbr>(全角半角混在可)<wbr>(半角100文字)<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "291":
        // 291 薬品服用注意レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        currentlinenbr = $(this).parent().index() - 1 ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("薬品服用注意レコード");
        $(this).parent().next().next().html("RP番号<br>" + '<input type="text" class="rpnbr" value=""><br>(適切なRP番号は)<input type="text" class="adqt_rpnbr_val" value="' + adqt_rpnbr + '">」です<div class="rpnr_chk_rslt"></div>');
        $(this).parent().next().next().next().html("内容<wbr>(薬品にかかる注意事項を出力<wbr>（全角半角混在可)<wbr>(全角半角混在可)<wbr>(半角400文字)<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "301":
        // 用法レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("用法レコード");
        $(this).parent().next().next().html("RP番号<br>" + '<input type="text" class="rpnbr" value=""><br>(適切なRP番号は)<input type="text" class="adqt_rpnbr_val" value="' + adqt_rpnbr + '">」です<div class="rpnr_chk_rslt"></div>');
        $(this).parent().next().next().next().html("用法名称<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("調剤数量<br>" + '<input type="text" class="col04" value="">');
        $(this).parent().next().next().next().next().next().html("調剤単位<br>" + '<input type="text" class="col05" value="">');
        $(this).parent().next().next().next().next().next().next().html("剤形コード<br>1. 内服、2. 内滴、3. 頓服、4. 注射、5. 外用、6. 浸煎、7. 湯、9. 材料、10. その他 (非保険薬、保険外あるいは医療機関で剤形が判断できない場合は「10.その他」として記録<br>※医療機関で浸煎薬・湯薬が判断できない場合は、内服または屯服として記録<br>※医療機関で内服滴剤が判断できない場合は内服として記録)<br>" + '<input type="text" class="col06" value="">');
        $(this).parent().next().next().next().next().next().next().next().html("用法コード種別<br>1. コードなし、2. JAMI用法コード、3～ 将来統一コードを想定<br>※「JAMI 用法ｺｰﾄﾞ」とは日本医療情報学会標準である「処方・注射オーダ標準用法規格」にて定められたコード体系である。<br>" + '<input type="text" class="col07" value="">');
        $(this).parent().next().next().next().next().next().next().next().next().html("用法コード<br>上記種別に対応した用法コード (「用法コード種別」が「1.コードなし」の場合は省略する。)<br>" + '<input type="text" class="col08" value="">');
        $(this).parent().next().next().next().next().next().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        yoho_rec_cnt = yoho_rec_cnt + 1 ;
        adqt_rpnbr = yoho_rec_cnt + 1
        break;
      case "311":
        // 用法補足レコード
        // 2022/10/07 追加
        // 一連のまとまった
        // 「301 (用法レコード (201 がある場合は必須))、311 (用法補足レコード (必須ではない))、
        // 391 (処方服用注意レコード (必須ではない))」の中で 301 が一連の 3xx の中で末尾ではない場合 (つまり 311 や 391 がある場合)に、
        // 余計に加算されている yoho_rec_cnt (301 の数) を -1 する。
        yoho_rec_cnt = yoho_rec_cnt - 1 ;
        adqt_rpnbr = yoho_rec_cnt + 1
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("用法補足レコード");
        $(this).parent().next().next().html("RP番号<br>" + '<input type="text" class="rpnbr" value=""><br>(適切なRP番号は)<input type="text" class="adqt_rpnbr_val" value="' + adqt_rpnbr + '">」です<div class="rpnr_chk_rslt"></div>');
        $(this).parent().next().next().next().html("用法補足情報<wbr>用法にかかる補足情報を出力 (全角半角混在可) (半角100文字)<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        // 2022/10/07 追加
        yoho_hosoku_rec_cnt = yoho_hosoku_rec_cnt + 1 ;
        yoho_rec_cnt = yoho_rec_cnt + 1 ;
        adqt_rpnbr = yoho_rec_cnt + 1
        break;
      case "391":
        // 処方服用注意レコード
        // 2022/10/07 追加
        // 一連のまとまった
        // 「301 (用法レコード (201 がある場合は必須))、311 (用法補足レコード (必須ではない))、
        // 391 (処方服用注意レコード (必須ではない))」の中で 301 が一連の 3xx の中で末尾ではない場合 (つまり 311 や 391 がある場合)に、
        // 余計に加算されている yoho_rec_cnt (301 の数) を -1 する。
        yoho_rec_cnt = yoho_rec_cnt - 1 ;
        adqt_rpnbr = yoho_rec_cnt + 1
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("処方服用注意レコード");
        $(this).parent().next().next().html("RP番号<br>" + '<input type="text" class="rpnbr" value=""><br>(適切なRP番号は)<input type="text" class="adqt_rpnbr_val" value="' + adqt_rpnbr + '">」です<div class="rpnr_chk_rslt"></div>');
        $(this).parent().next().next().next().html("内容<wbr>RP にかかる補足情報を出力 (全角半角混在可) (半角400文字)<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        // 2022/10/07 追加
        fukuyo_chui_rec_cnt = fukuyo_chui_rec_cnt + 1 ;
        yoho_rec_cnt = yoho_rec_cnt + 1 ;
        adqt_rpnbr = yoho_rec_cnt + 1
        break;
      case "401":
        // 服用注意レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("服用注意レコード");
        $(this).parent().next().next().html("内容<wbr>投薬全体にかかる注意事項を出力<wbr>(全角半角混在可)(半角400文字)<br>" + '<input type="text" class="toyakuzentai_chui" value="">');
        $(this).parent().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "411":
        // 医療機関等提供情報レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        currentlinenbr = $(this).parent().index() - 1 ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("医療機関等提供情報レコード");
        $(this).parent().next().next().html("内容<wbr>医療機関・薬局から患者に提供する情報<wbr>(全角半角混在可)<wbr>(半角400文字)<br>" + '<input type="text" class="col02" value="">');
        $(this).parent().next().next().next().html("情報提供種別<wbr>(数字2桁)<br>" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "421":
        // 残薬確認レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("残薬確認レコード");
        $(this).parent().next().next().html("残薬内容<wbr>医療機関・薬局が確認した患者の残薬の状況及び理由などを記録。<wbr>(全角半角混在可)<wbr>(半角400文字)<br>" + '<input type="text" class="col02" value="">');
        $(this).parent().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "501":
        // 備考レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        // $(this).parent().next().next().next().html("備考レコード");
        // $(this).parent().next().next().next().next().html("備考情報<wbr>出力内容は特に制限しない。<wbr>(全角半角混在可)<wbr>(半角400文字)<br>" + '<input type="text" class="col02" value="">');
        // $(this).parent().next().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().html("備考レコード");
        $(this).parent().next().next().html("備考情報<wbr>出力内容は特に制限しない。<wbr>(全角半角混在可)<wbr>(半角400文字)<br>" + '<input type="text" class="col02" value="">');
        $(this).parent().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "601":
        // 患者等記入レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("患者等記入情報");
        $(this).parent().next().next().html("備考情報<wbr>患者やその家族などから医師もしくは薬剤師に伝えたい内容を記録。<wbr>(全角半角混在可)<wbr>(半角400文字)<br>" + '<input type="text" class="col02" value="">');
        $(this).parent().next().next().next().html("入力年月日<br>西暦8桁YYYYMMDD、または和暦7桁GYYMMDD" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      case "701":
        // かかりつけ薬剤師レコード
//        $(this).parent().next().html("CSVファイルのオリジナル行番号");
//        $(this).parent().next().next().html("現状の行番号");
        $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
        // 表の何行目であるかを計測
        currentlinenbr = $(this).parent().parent().index() ;
        $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
        $(this).parent().next().html("かかりつけ薬剤師レコード");
        $(this).parent().next().next().html("かかりつけ薬剤師氏名<wbr>患者が同意したかかりつけ薬剤師の氏名<wbr>(全角半角混在可)<wbr>出来る限り姓と名の間に空白を1 桁入れて、それ以外の空白は詰めて記録<wbr>(半角40文字)<br>" + '<input type="text" class="col02" value="">');
        $(this).parent().next().next().next().html("勤務先薬局名称<br>かかりつけ薬剤師の勤務する薬局名称を記録<wbr>(全角半角混在可)<wbr>(半角120文字)" + '<input type="text" class="col03" value="">');
        $(this).parent().next().next().next().next().html("連絡先<wbr>かかりつけ薬剤師の連絡先を記録<wbr>(全角半角混在可)<wbr>(半角800文字)" + '<input type="text" class="col04" value="">');
        $(this).parent().next().next().next().next().next().html("担当開始日<wbr>かかりつけ薬剤師の担当開始日<wbr>西暦:8 桁YYYYMMDD 和暦:7 桁GYYMMDD<br>" + '<input type="text" class="col05" value="">');
        $(this).parent().next().next().next().next().next().next().html("担当開始日<wbr>かかりつけ薬剤師の担当終了日<wbr>西暦:8 桁YYYYMMDD 和暦:7 桁GYYMMDD<br>" + '<input type="text" class="col06" value="">');
        $(this).parent().next().next().next().next().next().next().next().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=""><p class="inputchkrslt"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().html("");
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
        $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        break;
      default:
        // バージョンレコード
//          $(this).parent().next().next().html('バージョン情報<br>JAHISTC”+(バージョン 半角数字) ※9 桁固定とするため、バージョンが1 桁の場合は「0」を付加することとする。' + '<input type="text" class="rec_number" value=""><div class="rec_number_chk_rslt"></div>');
        const varrec_const = "JAHISTC";
        regex = new RegExp(varrec_const);
        if (regex.test($(this).val()) == true) {
          varrec_verinfo = $(this).val() ;
//          $(this).parent().next().html("CSVファイルのオリジナル行番号");
//          $(this).parent().next().next().html("現状の行番号");
//          currentlinenbr = $("tbody#medicine_info-tbody tr").index(this) ;
          $(this).parent().prev().prev().html("CSVファイルのオリジナル行番号" + "<div class=" + String.fromCodePoint(34) + "csvorglinenbr" + String.fromCodePoint(34) + ">" + csvLineNbr + "</div>") ; 
          // 表の何行目であるかを計測
          currentlinenbr = $(this).parent().parent().index() ;
          $(this).parent().prev().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>") ;
          $(this).parent().next().html("バージョンレコード");
          $(this).parent().next().next().html('出力区分<br><ol><li>医療機関・薬局から患者等に情報を提供する場合</li><li>患者等から医療機関・薬局に情報を提供する場合</li></ol>'+ '<input type="text" class="verrec_outputtype" value=""><div class="verrec_outputtype_chk_rslt"></div>');
          $(this).parent().next().next().next().html("");
          $(this).parent().next().next().next().next().html("");
          $(this).parent().next().next().next().next().next().html("");
          $(this).parent().next().next().next().next().next().next().html("");
          $(this).parent().next().next().next().next().next().next().next().html("");
          $(this).parent().next().next().next().next().next().next().next().next().html("");
          $(this).parent().next().next().next().next().next().next().next().next().next().html("");
          $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV各列チェック結果" + '<p class="csvEachColChkSummaryStr"></p>');
          $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(期待値)" + '<p class="csvColMaxNbrExpectedVal"></p>');
          $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数(実測値)" + '<p class="csvColMaxNbrRealVal"></p>');
          $(this).parent().next().next().next().next().next().next().next().next().next().next().next().next().next().next().next().html("CSV列数チェック結果" + '<p class="csvcolNbrChkRsltStr"></p>');
        }
        break;
    }


  });

  $(document).on('focusout','.col_data_created_by',function(){
    let value = $(this).val();
    var chkrsltstr = "入力された値は「" + value + "」です。";

    if ( value == "" ) {
      rsltcd = 10002000 ;
      csv_check_ng_cnt = csv_check_ng_cnt + 1 ;
      var chkrsltstr = "(入力者欄の入力確認結果(1: 医療関係者、2: 患者): NG WARNING) 未入力です。(必要な対処) 半角の数字で 1 または 2 を入力してください。" + value;
    } else if ( value !== "1" && value !== "2" ) {
      rsltcd = 10000200 ;
      csv_check_ng_cnt = csv_check_ng_cnt + 1 ;
      var chkrsltstr = "(入力者欄の入力確認結果(1: 医療関係者、2: 患者): NG WARNING) 「" + value + "」が入力されています。(必要な対処) 半角の数字で 1 または 2 を入力してください。" + value;
    } else {
      rsltcd = 0 ;
      csv_check_ok_cnt = csv_check_ok_cnt + 1 ;
      var chkrsltstr = "(入力者欄の入力確認結果(1: 医療関係者、2: 患者): OK)";
    }
    $(this).next().text(chkrsltstr);
//    csv_check_result_buf = csv_check_result_buf + rowIdx + "\t" + colarr[0] + "\t" +  rsltcd  + "\t" +  $('table#medicine_info_table tr:last input:text[class="rpnbr"]').next().next().next().text() + "\n" ;
    // document.getElementById("csv_check_result_okcnt_ngcnt").innerHTML = "<p>OK: " + csv_check_ok_cnt + " NG: " + csv_check_ng_cnt;
    // document.getElementById("csv_check_result_textarea").value = csv_check_result_buf;
    //$('csv_check_result_okcnt_ngcnt').innerHTML("<p>OK: " + csv_check_ok_cnt + " NG: " + csv_check_ng_cnt) ;
    csv_check_result_buf = csv_check_result_buf + csv_rownbr + "\t" + csv_recnbr + "\t" +  rsltcd  + "\t" +  chkrsltstr + "\n" ;
    $('#csv_check_result_okcnt_ngcnt').html('<p>OK: ' + csv_check_ok_cnt + ' NG: ' + csv_check_ng_cnt + '</p>') ;
    $('textarea#csv_check_result_textarea').val(csv_check_result_buf) ;
  });


  $(document).on('focusout','.rpnbr',function(){
    let inputted_rpnbr = $(this).val();
//    let inputted_rpnbr = document.getElementByClass('rpnbr').innerText ;
    var chkrsltstr = "入力された値は「" + inputted_rpnbr + "」です。";
    let adequote_rpnbr = $(this).next().next().val();

//    console.log('$(this).val()=' + $(this).val());
//    console.log('$(this).next().val()=' + $(this).next().val());
//    console.log('$(this).next().next().val()=' + $(this).next().next().val());

    if ( inputted_rpnbr == adequote_rpnbr ) {
//      rsltcd = 02001000 ;
      rsltcd = 0 ;
      csv_check_ok_cnt = csv_check_ok_cnt + 1 ;
      var chkrsltstr = "(RPNo. 入力確認結果: OK)";
    } else {
//      rsltcd = 02001001 ;
      rsltcd = 1000120 ;
      csv_check_ng_cnt = csv_check_ng_cnt + 1 ;
      var chkrsltstr = "(RPNo. 入力確認結果: WARNING (NG)) 「" + inputted_rpnbr + "」が入力されています。(必要な対処) 正しくは「" + adequote_rpnbr  + "」を入力すべきです";
    }
    $(this).next().next().next().text(chkrsltstr);
    console.log('$(this).next().next().next().text()=' + $(this).next().next().next().text());
    csv_check_result_buf = csv_check_result_buf + csv_rownbr + "\t" + csv_recnbr + "\t" +  rsltcd  + "\t" +  chkrsltstr + "\n" ;

//    $('csv_check_result_okcnt_ngcnt').html("<p>OK: " + csv_check_ok_cnt + " NG: " + csv_check_ng_cnt) ;
    $('#csv_check_result_okcnt_ngcnt').html('<p>OK: ' + csv_check_ok_cnt + ' NG: ' + csv_check_ng_cnt + '</p>') ;
    $('csv_check_result_textarea').val(csv_check_result_buf) ;

    //    $('table#medicine_info_table tr:last input:text[class="rpnbr"]').val(colarr[1]);

/*
    $(this).next().next().next().text(chkrsltstr);
    console.log('$(this).next().next().next().val()=' + $(this).next().next().next().val());
*/
  });

  $(document).on('focusout','.drug_supplemental_info',function(){
    let value = $(this).val();
    var chkrsltstr = "入力された値は「" + value + "」です。";

      var unicodeArray = Encoding.stringToCode(value); // 文字列から文字コード値の配列に変換
      sjisArray = [] ;
      var sjisArray = Encoding.convert(unicodeArray, {
        to: 'SJIS', 
        from: 'UNICODE' 
      });
      if ( sjisArray.length > 100 ) {
        rsltcd = 10000200 ;
        csv_check_ng_cnt = csv_check_ng_cnt + 1 ;
        var chkrsltstr = "(281 の薬品補足情報入力の確認結果: NG WARNING) 入力文字数が「" + sjisArray.length + "」です。(必要な対処) 半角 100 文字以内に収まるように、文字数を減らしてください。" + value;
      } else {
        rsltcd = 0 ;
        csv_check_ok_cnt = csv_check_ok_cnt + 1 ;
        var chkrsltstr = "(281 の薬品補足情報入力の確認結果: OK) 入力文字数が「" + sjisArray.length + "」です。(必要な対処) 必要な対処はありません。" + value;
      }
      $(this).next().text(chkrsltstr);
//    csv_check_result_buf = csv_check_result_buf + rowIdx + "\t" + colarr[0] + "\t" +  rsltcd  + "\t" +  $('table#medicine_info_table tr:last input:text[class="rpnbr"]').next().next().next().text() + "\n" ;
    // document.getElementById("csv_check_result_okcnt_ngcnt").innerHTML = "<p>OK: " + csv_check_ok_cnt + " NG: " + csv_check_ng_cnt;
    // document.getElementById("csv_check_result_textarea").value = csv_check_result_buf;
    //$('csv_check_result_okcnt_ngcnt').innerHTML("<p>OK: " + csv_check_ok_cnt + " NG: " + csv_check_ng_cnt) ;
    csv_check_result_buf = csv_check_result_buf + csv_rownbr + "\t" + csv_recnbr + "\t" +  rsltcd  + "\t" +  chkrsltstr + "\n" ;
    $('#csv_check_result_okcnt_ngcnt').html('<p>OK: ' + csv_check_ok_cnt + ' NG: ' + csv_check_ng_cnt + '</p>') ;
    $('textarea#csv_check_result_textarea').val(csv_check_result_buf) ;

  });



/*
  $(document).on('blur', '.col_data_created_by', function() {
//    $(this).next().text('テストです');
    $(this).html = "";
  });
*/
  /*
  $(document).on('blur', '.col_data_created_by', function() {
//  $(document).on('blur', '.col_data_created_by', function() {
//  $('input[class="col_data_created_by"]').blur(function() {
    var curval = $(this).Val(); 
    if ($(this).Val() == '' ) {
      // (入力チェック結果: WARNING) ◆注意◆レコード作成者は「1」または「2」を入力する必要があります。
      $(this).next().text(' 1 または 2 を入力する必要があります。');
//      $(this).parent().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=\"" + curval + "\"">' + "");
    } else if (curval !== "1" || curval !== "2") {
      $(this).next().text(' 1 または 2 を入力する必要があります。');
//      $(this).parent().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=\"" + curval + "\"">' + "");
    } else {
      $(this).next().text('');
//      $(this).parent().html("レコード作成者 (1: 医療関係者から患者へ 2: 患者から医療関係者へ)<br>" + '<input type="text" class="col_data_created_by" value=\"" + curval + "\"">' + "");
    }
  });
*/

/*
  $(document).on('blur','col_data_created_by',function(){
    $(this).parent().html("") = $(this).parent().html("") + "test";
    switch ($(#recnumber>td).val()) {
        case "":
          break;
        case "55":
          break;
        case "201":
          if ($(this).val == "") {
            $(this).parent().html("") = $(this).parent().html("") + "test";

              };
          break;
        case "281":
          break;
        case "291":
          break;
        case "301":
          break;
        case "411":
          break;
        case "421":
          break;
        case "501":
          break;
        case "601":
          break;
        case "701":
          break;
        default:
          break;
        }});
*/

        // 行の一部を変更する
  $(document).on('change', '.changeList', function() {
    $(this)
      .parent()
      .next()
      .html($(this).val());
  });

  // 行を一つ上に移動
  $(document).on('click', '#medicine_info-tbody>tr:gt(1) .upList', function() {
    var t = $(this)
      .parent()
      .parent();
    var colvalb4chg = [] ;
    colvalb4chg[0] = t.children().html() ;
    colvalb4chg[1] = t.children().next().html() ;
    colvalb4chg[2] = t.children().next().next().html() ;
    colvalb4chg[3] = t.children().next().next().next().html() ;
    colvalb4chg[4] = t.children().next().next().next().next().html() ;
    colvalb4chg[5] = t.children().next().next().next().next().next().html() ;
    colvalb4chg[6] = t.children().next().next().next().next().next().next().html() ;
    colvalb4chg[7] = t.children().next().next().next().next().next().next().next().html() ;
    colvalb4chg[8] = t.children().next().next().next().next().next().next().next().next().html() ;
    colvalb4chg[9] = t.children().next().next().next().next().next().next().next().next().next().html() ;
    colvalb4chg[10] = t.children().next().next().next().next().next().next().next().next().next().next().html() ;
    colvalb4chg[11] = t.children().next().next().next().next().next().next().next().next().next().next().next().html() ;
    if (t.prev('tr')) {
      t.insertBefore(t.prev('tr')[0]);
    }
    // 押しのけた側の現在の行番号
    currentlinenbr = t.index() ;
    t.children().next().children().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr + "</div>").end() ;
    t.next().children().next().children().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + eval(currentlinenbr + 1) + "</div>").end() ;
/*
    $("#medicine_info-tbody tr td .currentlinenbr").html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr) ;
    t.children()
    t.children().html(colvalb4chg[0]) ;
    t.children().next().html(colvalb4chg[1]);
    t.children().next().next().html("現状の行番号" + "<div class=" + String.fromCodePoint(34) + "currentlinenbr" + String.fromCodePoint(34) + ">" + currentlinenbr)
    t.children().next().next().next().html(colvalb4chg[3]);
    t.children().next().next().next().next().html(colvalb4chg[4]);
    t.children().next().next().next().next().next().html(colvalb4chg[5]);
    t.children().next().next().next().next().next().next().html(colvalb4chg[6]);
    t.children().next().next().next().next().next().next().next().html(colvalb4chg[7]);
    t.children().next().next().next().next().next().next().next().next().html(colvalb4chg[8]);
    t.children().next().next().next().next().next().next().next().next().next().html(colvalb4chg[9]);
    t.children().next().next().next().next().next().next().next().next().next().next().html(colvalb4chg[10]);
    t.children().next().next().next().next().next().next().next().next().next().next().next().html(colvalb4chg[11]);
*/    
  });

  // 行を一つ下に移動
  $(document).on('click', '.downList', function() {
    var t = $(this)
      .parent()
      .parent();
    if (t.next('tr')) {
      t.insertAfter(t.next('tr')[0]);
    }
  });

  // 行を追加する
  $(document).on('click', '.addList', function() {
    $('#medicine_info-tbody>tr')
      .eq(0)
      .clone(true)
      .insertAfter(
        $(this)
          .parent()
          .parent(),
      );
  });

  // 行を削除する
  $(document).on('click', '.removeList', function() {
    $(this)
      .parent()
      .parent()
      .remove();
  });
  return;
});
</script>

<script>
function medicineinfo_part02_type01_dat_create() {
// medicine_info_table

    var data = [];
//    var cell_arr = [];
    var outbuf_arr = [];
    var tr = $("table#medicine_info_table tr");//テーブルの全行を取得
    for( var i=1,l=tr.length;i<l;i++ ){
        var cell_arr = [];
        var cells = tr.eq(i).children();//1行目から順番に列を取得(th、td)

//        console.log("今は「" + i + "」行目です");
//        console.table(cells);


//    if ( cells.eq(0).find("input").val().length > 0 ) {
    if ( cells.eq(2).find("input").val().length > 0 ) {
    var maxColIdx = 0;
//    console.log("cells.eq(0).find(\"input\").val()=" + cells.eq(0).find("input").val());
//    switch (cells.eq(0).find("input").val()) {
    switch (cells.eq(2).find("input").val()) {
      case "1":  //  1 患者情報レコード
        maxColIdx = 10;
        break;
      case "5":  //  5 調剤年月日レコード
        maxColIdx = 2;
        break;
      case "11":  //  11 調剤－医療機関等レコード
        maxColIdx = 8;
        break;
      case "15":  //  15 調剤－医師・薬剤師レコード
        maxColIdx = 3;
        break;
      case "51":  //  51 処方－医療機関レコード
        maxColIdx = 5;
        break;
      case "55":  //  55 処方－医師レコード
        maxColIdx = 3;
        break;
      case "201": // 201 薬品レコード
        maxColIdx = 7;
        break;
      case "281": // 281 薬品補足レコード
        maxColIdx = 3;
        break;
      case "291": // 291 薬品服用注意レコード
        maxColIdx = 3;
        break;
      case "301": // 301 用法レコード
        maxColIdx = 8;
        break;
      case "311": // 311 用法補足レコード
        maxColIdx = 3;
        break;
      case "391": // 391 所要服用注意レコード
        maxColIdx = 3;
        break;
      case "401": // 401 服用注意レコード
        maxColIdx = 2;
        break;
      case "411": // 401 服用注意レコード
        maxColIdx = 3;
        break;
      case "421": // 421 残薬確認レコード
        maxColIdx = 2;
        break;
      case "501": // 501 備考レコード
        maxColIdx = 2;
        break;
      case "601": // 601 患者等記入レコード
        maxColIdx = 2;
        break;
      case "701": // 701 かかりつけ薬剤師レコード
        maxColIdx = 6;
        break;
      default:
        /*
        const varrec_const = "JAHISTC";
        regex = new RegExp(varrec_const);
        if (regex.test($(this).val()) == true) {
          maxColIdx = 1;
        }
        */
        maxColIdx = 1;
        break;
    }
      var tmp_str = cells.eq(02).find("input").val();
//      if ( cells.eq(0).find("input").val().length > 0 ) {
      if ( cells.eq(2).find("input").val().length > 0 ) {
        //for( var colIdx =0,mx=maxColIdx + 2;colIdx <mx;colIdx ++ ){
        for( var colIdx =2,mx=maxColIdx + 4;colIdx <mx;colIdx ++ ){
          if ( colIdx != 3 ) {
            cell_arr.push(cells.eq(colIdx).find("input").val());
            console.log (cells.eq(colIdx).find("input").val()) ;
          }
        }
        var oneline_str = cell_arr.join(',');
        outbuf_arr.push(oneline_str);
      }
    }
    }
  var outbuf = outbuf_arr.join("\n");
  document.getElementById("textarea_medicineinfo_part02_type01").value = outbuf;
  return;
}
</script>

<script>
  function medicineinfo_part02_type03_dat_create() {
  // medicine_info_table
  
      var data = [];
  //    var cell_arr = [];
      var outbuf_arr = [];
      var tr = $("table#medicine_info_table tr");//テーブルの全行を取得
      for( var i=1,l=tr.length;i<l;i++ ){
          var cell_arr = [];
          var cells = tr.eq(i).children();//1行目から順番に列を取得(th、td)
  
  //        console.log("今は「" + i + "」行目です");
  //        console.table(cells);
  
  
  //    if ( cells.eq(0).find("input").val().length > 0 ) {
      if ( cells.eq(2).find("input").val().length > 0 ) {
      var maxColIdx = 0;
  //    console.log("cells.eq(0).find(\"input\").val()=" + cells.eq(0).find("input").val());
  //    switch (cells.eq(0).find("input").val()) {
      switch (cells.eq(2).find("input").val()) {
        case "1":  //  1 患者情報レコード
          maxColIdx = 10;
          break;
        case "5":  //  5 調剤年月日レコード
          maxColIdx = 2;
          break;
        case "11":  //  11 調剤－医療機関等レコード
          maxColIdx = 8;
          break;
        case "15":  //  15 調剤－医師・薬剤師レコード
          maxColIdx = 3;
          break;
        case "51":  //  51 処方－医療機関レコード
          maxColIdx = 5;
          break;
        case "55":  //  55 処方－医師レコード
          maxColIdx = 3;
          break;
        case "201": // 201 薬品レコード
          maxColIdx = 7;
          break;
        case "281": // 281 薬品補足レコード
          maxColIdx = 3;
          break;
        case "291": // 291 薬品服用注意レコード
          maxColIdx = 3;
          break;
        case "301": // 301 用法レコード
          maxColIdx = 8;
          break;
        case "311": // 311 用法補足レコード
          maxColIdx = 3;
          break;
        case "391": // 391 所要服用注意レコード
          maxColIdx = 3;
          break;
        case "401": // 401 服用注意レコード
          maxColIdx = 2;
          break;
        case "411": // 401 服用注意レコード
          maxColIdx = 3;
          break;
        case "421": // 421 残薬確認レコード
          maxColIdx = 2;
          break;
        case "501": // 501 備考レコード
          maxColIdx = 2;
          break;
        case "601": // 601 患者等記入レコード
          maxColIdx = 2;
          break;
        case "701": // 701 かかりつけ薬剤師レコード
          maxColIdx = 6;
          break;
        default:
          /*
          const varrec_const = "JAHISTC";
          regex = new RegExp(varrec_const);
          if (regex.test($(this).val()) == true) {
            maxColIdx = 1;
          }
          */
          maxColIdx = 1;
          break;
      }
        var tmp_str = cells.eq(02).find("input").val();
  //      if ( cells.eq(0).find("input").val().length > 0 ) {
        if ( cells.eq(2).find("input").val().length > 0 ) {
          //for( var colIdx =0,mx=maxColIdx + 2;colIdx <mx;colIdx ++ ){
          for( var colIdx =2,mx=maxColIdx + 4;colIdx <mx;colIdx ++ ){
            if ( colIdx != 3 ) {
              cell_arr.push(cells.eq(colIdx).find("input").val());
              console.log (cells.eq(colIdx).find("input").val()) ;
            }
          }
          if ( cell_arr[0] === "1" || cell_arr[0] === "5" || cell_arr[0] === "11" || cell_arr[0] === "15" || cell_arr[0] === "51" || cell_arr[0] === "55" || cell_arr[0] === "201" || cell_arr[0] === "281" || cell_arr[0] === "291" || cell_arr[0] === "301" || cell_arr[0] === "311" || cell_arr[0] === "391" ) {
            var oneline_str = cell_arr.join(',');
            outbuf_arr.push(oneline_str);
          }
        }
      }
      }
    var outbuf = outbuf_arr.join("\n");
    document.getElementById("textarea_medicineinfo_part02_type03").value = outbuf;
    return;
  }
  </script>
  

<script>
function medicineinfo_part01_dat_create() {
  var varec_arr = [];
  varec_arr.push(document.getElementById('verrec_verinfo').value);
  varec_arr.push(document.getElementById('verrec_outputtype').value);
  var varec_str = varec_arr.join(',');
    
  var patientinfo_rec_arr = [];
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_rec_number').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_name_orgchar').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_sex').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_date_of_birth').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_postalcode').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_postaladdress').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_phonenumber').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_emergency_contact_information').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_bloodtype').value);
  patientinfo_rec_arr.push(document.getElementById('patientinfo_rec_patient_weight').value);
  if (isHiragana(document.getElementById('patientinfo_rec_patientname_katakana').value)) {
    var katakana_str = Encoding.toKatakanaCase(document.getElementById('patientinfo_rec_patientname_katakana').value);
  } else {
    var katakana_str = document.getElementById('patientinfo_rec_patientname_katakana').value;
  }
  patientinfo_rec_arr.push(katakana_str);
  var patientinfo_rec_str = patientinfo_rec_arr.join(',');

  var dispensing_date_info_arr = [];
  dispensing_date_info_arr.push(document.getElementById('dispensing_date_info_rec_rec_number').value);
  dispensing_date_info_arr.push(document.getElementById('dispensing_date_info_rec_date_of_dispensing').value);
  dispensing_date_info_arr.push(document.getElementById('dispensing_date_info_rec_date_inputted_by').value);
  var dispensing_date_info_str = dispensing_date_info_arr.join(',');

  var dispensing_med_inst_info_rec_arr = [];
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_rec_number').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_name').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_pref_cd').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_points_tbl_cd').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_cd').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_postal_cd').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_postal_address').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_landline_phone_number').value);
  dispensing_med_inst_info_rec_arr.push(document.getElementById('dispensing_med_inst_info_rec_medical_institutions_data_inputted_by').value);
  var dispensing_med_inst_info_rec_str = dispensing_med_inst_info_rec_arr.join(',');

  var dispensing_doctor_pharmacist_info_rec_arr = [];
  dispensing_doctor_pharmacist_info_rec_arr.push(document.getElementById('dispensing_doctor_pharmacist_info_rec_rec_number').value);
  dispensing_doctor_pharmacist_info_rec_arr.push(document.getElementById('dispensing_doctor_pharmacist_info_rec_fullname').value);
  dispensing_doctor_pharmacist_info_rec_arr.push(document.getElementById('dispensing_doctor_pharmacist_info_rec_contact_address').value);
  dispensing_doctor_pharmacist_info_rec_arr.push(document.getElementById('dispensing_doctor_pharmacist_info_rec_inputted_by').value);
  var dispensing_doctor_pharmacist_info_rec_str = dispensing_doctor_pharmacist_info_rec_arr.join(',');
/*
  var prescription_medical_institutions_info_rec_arr = [];
  prescription_medical_institutions_info_rec_arr.push(document.getElementById('prescription_medical_institutions_info_rec_rec_number').value);
  prescription_medical_institutions_info_rec_arr.push(document.getElementById('prescription_medical_institutions_info_rec_name').value);
  prescription_medical_institutions_info_rec_arr.push(document.getElementById('prescription_medical_institutions_info_rec_pref_cd').value);
  prescription_medical_institutions_info_rec_arr.push(document.getElementById('prescription_medical_institutions_info_rec_points_tbl_cd').value);
  prescription_medical_institutions_info_rec_arr.push(document.getElementById('prescription_medical_institutions_info_rec_medical_institutions_cd').value);
  prescription_medical_institutions_info_rec_arr.push(document.getElementById('prescription_medical_institutions_info_rec_inputted_by').value);
  var prescription_medical_institutions_info_rec_str = prescription_medical_institutions_info_rec_arr.join(',');
*/  
  var csv_output_arr = [];
//  csv_output_arr.push(varec_str);
  csv_output_arr.push(patientinfo_rec_str);
  csv_output_arr.push(dispensing_date_info_str);
  var chk_tmp_str = dispensing_med_inst_info_rec_str.replace(/,/g,"") ;
  if (chk_tmp_str.length > 0) {
    csv_output_arr.push(dispensing_med_inst_info_rec_str);
  } 
  var chk_tmp_str = dispensing_doctor_pharmacist_info_rec_str.replace(/,/g,"") ;
  if (chk_tmp_str.length > 0) {
    csv_output_arr.push(dispensing_doctor_pharmacist_info_rec_str);
  } 
/*
  var chk_tmp_str = prescription_medical_institutions_info_rec_str.replace(/,/g,"") ;
  if (chk_tmp_str.length > 0) {
    csv_output_arr.push(prescription_medical_institutions_info_rec_str);
  } 
*/
  var csv_output_str = csv_output_arr.join('\n');

  document.getElementById("medicineinfo_part01").value = csv_output_str;
  document.getElementById("medicineinfo_part01_textlen").innerHTML = "文字数: " + csv_output_str.length;

  return;
}
</script>

<script>
function isHiragana(str){
/*
// https://javascript.programmer-reference.com/js-check-hiragana/
  str = (str==null)?"":str;
  if(str.match(/^[ぁ-んー]*$/)){
    return true;
  }else{
    return false;
  }
*/
  // https://pisuke-code.com/js-check-hira-kana-kanzi/
  var regexp = /[\u{3000}-\u{301C}\u{3041}-\u{3093}\u{309B}-\u{309E}]/mu;
  if (regexp.test(str)) {
    return true;
  }else{
    return false;
  }

}
</script>

<script>
function medicineinfo_concat_proc() {

  document.getElementById('concatcsv_genqr_proc_status').innerHTML = "<p>処理実行中。しばらくお待ちください…</p>";


  var drugnote_tmp_arr = [] ;

  var varec_arr = [];
//  varec_arr.push(document.getElementsByClassName('verrec_verinfo').value);
//  varec_arr.push(document.getElementsByClassName('verrec_outputtype').value);

  varec_arr.push(varrec_verinfo);
//  concole.log ("verrec_outputtype = " + document.getElementsByClassName('verrec_outputtype').item(0).value);
  varec_arr.push(document.getElementsByClassName('verrec_outputtype').item(0).value);

  var varec_str = varec_arr.join(',');
//  varec_arr.push(varec_str);


//  drugnote_tmp_arr.push(varec_arr);
//  drugnote_tmp_arr.push(document.getElementById("medicineinfo_part01").value);
  drugnote_tmp_arr.push(document.getElementById("textarea_medicineinfo_part02_type01").value);
  if (document.getElementById("textarea_medicineinfo_part02_type01").value.length > 0) {
    var drugnote_str = drugnote_tmp_arr.join("\n");
  } else {
    // var drugnote_str = document.getElementById("textarea_medicineinfo_part02_type01").value;
  }
  document.getElementById("medicineinfo_type01_concatted").value = drugnote_str;
  
  var drugnote_allarr = [] ;
  drugnote_allarr = drugnote_str.split("\n");


  var output_arr = [] ;
  var oneqrdat_arr = [];
  var oneqrdat_idx = 1;

  var org_utf16_str = "";
  

  // https://mekou.com/linux-magazine/javascript%E3%81%A7%E7%8F%BE%E5%9C%A8%E6%99%82%E5%88%BB%E3%82%92yyyymmddhhmmss%E3%81%A7%E5%87%BA%E5%8A%9B%E3%81%99%E6%96%B9%E6%B3%95/
  var chozai_date = new Date();
  console.log(chozai_date.getFullYear() + '/' + ('0' + (chozai_date.getMonth() + 1)).slice(-2) + '/' +('0' + chozai_date.getDate()).slice(-2) + ' ' +  ('0' + chozai_date.getHours()).slice(-2) + ':' + ('0' + chozai_date.getMinutes()).slice(-2) + ':' + ('0' + chozai_date.getSeconds()).slice(-2) + '.' + chozai_date.getMilliseconds());
//92345678901234
//yyyymmddhhmmss
  var csvsplit_rec_number = 911;
//  var csvsplit_dat_unique_id = 12345678901234;
// var csvsplit_dat_unique_id = 92345678901234;
if (document.getElementsByClassName('dispensing_date_info_rec_date_of_dispensing').item(0).value != "" ) {
  var chozai_ymd = document.getElementsByClassName('dispensing_date_info_rec_date_of_dispensing').item(0).value;
} else {
  var chozai_ymd = chozai_date.getFullYear() + ('0' + (chozai_date.getMonth() + 1)).slice(-2) + ('0' + chozai_date.getDate()).slice(-2);
}
 var csvsplit_dat_unique_id = chozai_ymd + ('0' + chozai_date.getHours()).slice(-2) + ('0' + chozai_date.getMinutes()).slice(-2) + ('0' + chozai_date.getSeconds()).slice(-2);
//  var csvsplit_dat_unique_id = 20220706225100 ;
  var csvsplit_maxnum = 0;
  var csvsplit_idx = 1;

  var tmp_utf16_str = varec_str; // csv を複数に分割する際、1行目はヘッダを付与する
  var tmp_utf16_str_len = 0;
  var tmp2_utf16_str = "";
  var tmp3_utf16_str = "";
  var tmp4_utf16_str = "";

  const varrec_const = "JAHISTC";
  reg = new RegExp(varrec_const);

  for (let i = 0; i < drugnote_allarr.length; ++i) {
//    console.log("drugnote_allarr[" + i+ "]=" + drugnote_allarr[i]);
//    console.log("tmp_utf16_str=" + tmp_utf16_str);
//    console.log("tmp_utf16_str.length=" + tmp_utf16_str.length);
    tmp_str_utf16_len = tmp_utf16_str.length;
    
//    if (drugnote_allarr[i].match(reg)) {
    if (drugnote_allarr[i].match(reg)) {
      ; // 行に「JAHISTC」を含んでいる場合は、その行を読み飛ばす
    } else {
      ; // 行に「JAHISTC」を含んでいない場合は、分割 CSV に出力する。
      // ★
      var max_utf16_char_val_cfg = document.getElementById("max_utf16_char_val_inputted").value ;
      
      if ( i + 1 <= drugnote_allarr.lenth ) {
        tmp2_utf16_str = tmp_utf16_str + drugnote_allarr[i + 1] ;
        tmp3_utf16_str = drugnote_allarr[i + 1] ;
      } else {
        tmp2_utf16_str = tmp_utf16_str ;
        tmp3_utf16_str = "" ;
      }
      tmp4_utf16_str = drugnote_allarr[i] ;
//      if (tmp_utf16_str.length > max_utf16_char_val_cfg) {
      if (tmp2_utf16_str.length > max_utf16_char_val_cfg || tmp3_utf16_str.length >= 106 || tmp4_utf16_str.length >= 106) {
        oneqrdat_arr.push(tmp_utf16_str);
//        console.log("oneqrdat_arr.push(tmp_utf16_str)" + tmp_utf16_str)
        tmp_utf16_str = varec_str; // csv を複数に分割する際、1行目はヘッダを付与する
        tmp_utf16_str = tmp_utf16_str + "\n" + drugnote_allarr[i] ;
      } else {
        if (tmp_utf16_str.length > 0) {
          tmp_utf16_str = tmp_utf16_str + "\n" + drugnote_allarr[i] ;
//          console.log("tmp_utf16_str=" + tmp_utf16_str)
//          console.log("tmp_utf16_str.length=" + tmp_utf16_str.length)
        } else {
          tmp_utf16_str = drugnote_allarr[i] ;
//          console.log("tmp_utf16_str=" + tmp_utf16_str)
//          console.log("tmp_utf16_str.length=" + tmp_utf16_str.length)
        }
      }
    }
    
    if (i + 1 >= drugnote_allarr.length) {
      oneqrdat_arr.push(tmp_utf16_str);
//      console.log("oneqrdat_arr.push(tmp_utf16_str)" + tmp_utf16_str)
    }
    csvsplit_maxnum = oneqrdat_arr.length;
  }

  for (let k = 0; k < oneqrdat_arr.length; ++k) {
    csvsplit_idx = k + 1;
    var csvsplit_rec_arr = [];
    csvsplit_rec_arr.push(csvsplit_rec_number);
    csvsplit_rec_arr.push(csvsplit_dat_unique_id);
    csvsplit_rec_arr.push(csvsplit_maxnum);
    csvsplit_rec_arr.push(csvsplit_idx);
    var csvsplit_rec_str = csvsplit_rec_arr.join(',');
    oneqrdat_arr[k] = oneqrdat_arr[k] + "\n" + csvsplit_rec_str;
  }

  var html_str = ""; 
  if (oneqrdat_arr.length > 0) {
    html_str = html_str + "<a href=\"#idimg-qr" + (0) + "\"\">1つ目のQRに移動</a><br>\n";
    html_str = html_str + "<a href=\"#idimg-qr" + (oneqrdat_arr.length - 1) + "\"\">最後 (" + oneqrdat_arr.length + "個目) のQRに移動</a><br>\n";
  }

  html_str = html_str + '<table border="1" cellspacing="0">';
  html_str = html_str + "<tr><th>分割された CSV ファイルの内容</th>";
  html_str = html_str + "<th>n 番目/全 n 個</th>";
  html_str = html_str + '<th>QRコード</th>';
  html_str = html_str + '<th>(余白)</th>';
  html_str = html_str +  "</tr>\n";
  var sjisStrArr = [] ;
  for (let j = 0; j < oneqrdat_arr.length; ++j) {
      var qrtext = oneqrdat_arr[j].replace(/\n/g, '\r\n');
      var unicodeArray = Encoding.stringToCode(qrtext); // 文字列から文字コード値の配列に変換
      sjisArray = [] ;
      var sjisArray = Encoding.convert(unicodeArray, {
        to: 'SJIS', 
        from: 'UNICODE' 
      });
      var sjisStr = Encoding.codeToString(sjisArray)
      sjisStrArr.push(sjisStr);
//      let x = 0;
//      let idbasenm = "idimg-qr"
//      $('div').attr("id", _ => idbasenm + x++);
      $("#idimg-qr" + j).qrcode({width:200,height:200,text:"https://wwww.google.co.jp/"});
//    jquery("#idimg-qr" + j).qrcode("https://wwww.google.co.jp/");

    html_str = html_str + "<tr><td>" + oneqrdat_arr[j].replace(/\n/g, "<br>\n") + "</td>";
    html_str = html_str + "<td>" + (j + 1) + " 番目/全 " + (oneqrdat_arr.length) + " 個</td>";
    html_str = html_str + '<td><div id="idimg-qr' + j + '"></div>';
    html_str = html_str + '<td>(余白)</div>';
    html_str = html_str +  "</tr>\n";

    html_str = html_str + "<tr><td>";
    if (j - 2 >= 0) {
      html_str = html_str + "<a href=\"#idimg-qr" + (j - 2) + "\"\">2つ前のQRに移動</a> ";
    } else {
      html_str = html_str + "2つ前のQRに移動 ";
    }
    if (j - 1 >= 0) {
      html_str = html_str + "<a href=\"#idimg-qr" + (j - 1) + "\"\">1つ前のQRに移動</a> ";
    } else {
      html_str = html_str + "1つ前のQRに移動 ";
    }
    if (j + 1 < oneqrdat_arr.length) {
      html_str = html_str + "<a href=\"#idimg-qr" + (j + 1) + "\"\">1つ次のQRに移動</a> ";
    } else {
      html_str = html_str + "1つ次のQRに移動 ";
    }
    if (j + 2 < oneqrdat_arr.length) {
      html_str = html_str + "<a href=\"#idimg-qr" + (j + 2) + "\"\">2つ次のQRに移動</a> ";
    } else {
      html_str = html_str + "2つ次のQRに移動 ";
    }
    html_str = html_str + "データ部の文字の長さ (utf16) 「" + oneqrdat_arr[j].length + "」"
    html_str = html_str + "(QRコード読み取りエラー防止のための余白)</td>";
    html_str = html_str + "<td></td>";
    html_str = html_str + "<td>(余白)</td>";
    html_str = html_str + "</tr>\n";
  }
  html_str = html_str + "</table>\n";
  document.getElementById("lastoutput01").innerHTML = html_str;
  for (let j = 0; j < oneqrdat_arr.length; ++j) {
    $("#idimg-qr" + j).qrcode({width:300,height:300,text:sjisStrArr[j]});
  }

  document.getElementById('concatcsv_genqr_proc_status').innerHTML = "<p>CSV作成とQRコード作成処理が完了しました。</p>";

//  medicineinfo_div_qr_create();

  return;
}
</script>

<script>
function medicineinfo_div_qr_create() {

  document.getElementById('concatcsv_genqr_proc_status2').innerHTML = "<p>処理実行中。しばらくお待ちください…</p>";

/*
  document.getElementById('concatcsv_genqr_proc_status').innerHTML = "<p>処理実行中。しばらくお待ちください…</p>";

  var drugnote_tmp_arr = [] ;

  var varec_arr = [];
  
  varec_arr.push(document.getElementById('verec_verinfo').value);
  varec_arr.push(document.getElementById('verrec_outputtype').value);
  var varec_str = varec_arr.join(',');
//  varec_arr.push(varec_str);


  drugnote_tmp_arr.push(varec_arr);
  drugnote_tmp_arr.push(document.getElementById("medicineinfo_part01").value);
  drugnote_tmp_arr.push(document.getElementById("textarea_medicineinfo_part02_type01").value);
  if (document.getElementById("textarea_medicineinfo_part02_type01").value.length > 0) {
    var drugnote_str = drugnote_tmp_arr.join("\n");
  } else {
    // var drugnote_str = document.getElementById("textarea_medicineinfo_part02_type01").value;
  }

*/
  
  var drugnote_utf16_temp_allstr = document.getElementById("medicineinfo_type01_concatted").value;
      var drugnote_utf16_allstr = drugnote_utf16_temp_allstr.replace(/\n/g, '\r\n');
      var unicodeArray = Encoding.stringToCode(drugnote_utf16_allstr); // 文字列から文字コード値の配列に変換
      inSjisAllArray = [] ;
      var inSjisAllArray = Encoding.convert(unicodeArray, {
        to: 'SJIS', 
        from: 'UNICODE' 
      });
      output_utf16_strarr = [];
      
      var inSjisAllArray_len = inSjisAllArray.length;
      
      var max_sjis_char_val_cfg = document.getElementById("max_sjis_char_val_inputted").value ;
      var outQrByteArr = [];
      var outSjisArr = [];
      var outSjisArrIdx = 1;
      for (inSjisArrIdx = 0; inSjisArrIdx < inSjisAllArray_len; inSjisArrIdx++) {


        if (outSjisArr.length + 1 == max_sjis_char_val_cfg) {
          console.log("■:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
//          if ( isThisCharTheFirstByteOfSJis(inSjisAllArray[inSjisArrIdx + 1]) == true ) {
          if ( isPossibleThisCharIsTheFirstByteOfSJis(inSjisAllArray[inSjisArrIdx + 1]) == true ) {
            console.log("★タイプ2開始:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            console.log("★タイプ2終了:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
//            console.table(inSjisAllArray) ;
          } else if (outSjisArr.length == max_sjis_char_val_cfg) {
            console.log("★タイプ4:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
          } else {
            console.log("★タイプ3:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
          }
        } else if (outSjisArr.length == max_sjis_char_val_cfg) {
          console.log("★タイプ1X:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
          outQrByteArr.push(outSjisArr);
          outSjisArr = []; 
        } else if (inSjisArrIdx -1 == inSjisAllArray_len) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            console.log("★タイプ6:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        } else {
          console.log("★タイプ5:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length + ":" + max_sjis_char_val_cfg + ":" + inSjisAllArray.length) ;
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
        }
        
        if (inSjisArrIdx -1 == inSjisAllArray_len) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            console.log("★タイプ6:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        }


/*
        console.log("★inSjisAllArray.length:" + inSjisAllArray.length ) ;
        console.log("★outSjisArr.length:" + outSjisArr.length ) ;
        console.log("★outQrByteArr.length:" + outQrByteArr.length ) ;
        
        if (outSjisArr.length + 1 < max_sjis_char_val_cfg) {
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
          console.log("★タイプ1:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        } else if (outSjisArr.length + 1 == max_sjis_char_val_cfg) {
          if ( isThisCharTheFirstByteOfSJis(inSjisAllArray[inSjisArrIdx + 1]) == true ) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            console.log("★タイプ2:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
          } else {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            console.log("★タイプ3:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
          }
        } else if (outSjisArr.length == max_sjis_char_val_cfg) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            console.log("★タイプ4:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        } else {
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            console.log("★タイプ5:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        }
        
        if (inSjisArrIdx -1 == inSjisAllArray_len) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            console.log("★タイプ6:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        }
*/
        
/*

        if (outSjisArr.length + 1 < max_sjis_char_val_cfg) {
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
        } else if (outSjisArr.length - 1 == max_sjis_char_val_cfg) {
          if ( isThisCharTheFirstByteOfSJis(inSjisAllArray[inSjisArrIdx + 1]) == true ) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
          } else if (outSjisArr.length == max_sjis_char_val_cfg) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
          }
        }

        if (outSjisArr.length + 1 < max_sjis_char_val_cfg) {
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
        } else if (outSjisArr.length + 1 == max_sjis_char_val_cfg) {
          if ( isThisCharTheFirstByteOfSJis(inSjisAllArray[inSjisArrIdx + 1]) == true ) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
          } else if (outSjisArr.length == max_sjis_char_val_cfg) {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
          }
        }

        if ( inSjisArrIdx >= 41 && inSjisArrIdx <= 46) {
          console.log("★注意(41から46です:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        }
        if ( (outSjisArr.length + 1 > max_sjis_char_val_cfg) && (inSjisArrIdx + 1 < inSjisAllArray_len) ) {
          if (inSjisAllArray[inSjisArrIdx + 1] >= parseInt("81", 16) && inSjisAllArray[inSjisArrIdx + 1] <= parseInt("9f", 16)) {
            console.log("★タイプ1:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
          } else if (inSjisAllArray[inSjisArrIdx + 1] >= parseInt("e0", 16) && inSjisAllArray[inSjisArrIdx + 1] <= parseInt("fc", 16)) {
            console.log("★タイプ2:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
          }
        } else if ( outSjisArr.length < max_sjis_char_val_cfg ) {
          console.log("★タイプ3:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
        } else if ( outSjisArr.length = max_sjis_char_val_cfg ) {
          console.log("★タイプ4:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
          outQrByteArr.push(outSjisArr);
          outSjisArr = []; 
        } else if ( outSjisArr.length > max_sjis_char_val_cfg ) {
          console.log("★タイプ5:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
          outSjisArr = []; 
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
        } else {
          console.log("★タイプ6:" + inSjisArrIdx + ":" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
        }
*/      
      }

      var html_str = "";
//      html_str = html_str + "<table border='1' cellspacing='0'>";
      html_str = html_str + "<table>";
      
      var outUtf16Arr = [];
      var qrArrMaxNbr = outQrByteArr.length;
      for (outQrArrIdx = 0; outQrArrIdx < qrArrMaxNbr; outQrArrIdx++) {
        var tmpArr = Encoding.convert(outQrByteArr[outQrArrIdx], {
          to: 'UNICODE', 
          from:  'SJIS'
        });
        var tmpStr = Encoding.codeToString(tmpArr);
        html_str = html_str + "<tr><td>" + tmpStr + "</td><td>" + outQrArrIdx +"/" + qrArrMaxNbr + "</td></tr>\n";
      }
      html_str = html_str + "</table>";
      document.getElementById("div_qr_output_area01").innerHTML = html_str;
      document.getElementById('concatcsv_genqr_proc_status').innerHTML = "<p>CSV作成とQRコード作成処理が完了しました。</p>";
//      var sjisStr = Encoding.codeToString(sjisAllArray)
//      sjisStrArr.push(sjisStr);

}
</script>


<script>
function medicineinfo_div_qr_create_test02() {

  document.getElementById('concatcsv_genqr_proc_status2').innerHTML = "<p>処理実行中。しばらくお待ちください…</p>";

/*
  var drugnote_tmp_arr = [] ;

  var varec_arr = [];
  
  varec_arr.push(document.getElementById('verec_verinfo').value);
  varec_arr.push(document.getElementById('verrec_outputtype').value);
  var varec_str = varec_arr.join(',');
//  varec_arr.push(varec_str);


  drugnote_tmp_arr.push(varec_arr);
  drugnote_tmp_arr.push(document.getElementById("medicineinfo_part01").value);
  drugnote_tmp_arr.push(document.getElementById("textarea_medicineinfo_part02_type01").value);
  if (document.getElementById("textarea_medicineinfo_part02_type01").value.length > 0) {
    var drugnote_str = drugnote_tmp_arr.join("\n");
  } else {
    // var drugnote_str = document.getElementById("textarea_medicineinfo_part02_type01").value;
  }

*/

  var test01Val = 0;
  var mymyTmp01 = "11";
  var mymyTmp02 = "00";
  var mymyTmp10 = mymyTmp01 + mymyTmp02;
  var mymyTmp11 = "0b" + mymyTmp01 + mymyTmp02;
  var mymyTmp13 = parseInt(mymyTmp11, 10);

  // http://yas-hummingbird.blogspot.com/2009/08/21016.html
  //16進数→10進数
  var foo = parseInt("30", 16); //10

  console.log("あ=" + "あ".codePointAt(0));
  console.log("あ=" + "あ".codePointAt(0).toString(16));
  console.log("A".codePointAt(0));
  console.log("A=" + "A".codePointAt(0).toString(16));
  console.log("あ...\u{3042}"); //あ
  console.log("A...\u{41}");




  var drugnote_utf16_temp_allstr = document.getElementById("medicineinfo_type02_concatted").value;
//  var drugnote_utf16_temp_allstr = document.getElementById("sjis_slice_text_data").value;
      var drugnote_utf16_allstr = drugnote_utf16_temp_allstr.replace(/\n/g, '\r\n');
      var unicodeArray = Encoding.stringToCode(drugnote_utf16_allstr); // 文字列から文字コード値の配列に変換
      inSjisAllArray = [] ;
      var inSjisAllArray = Encoding.convert(unicodeArray, {
        to: 'SJIS', 
        from: 'UNICODE' 
      });
 
      var parityByte = 0 ;
      var tmpArrIdx = 0;

      parityByte = inSjisAllArray[0] ;
      for (tmpArrIdx = 1; tmpArrIdx < inSjisAllArray.length; tmpArrIdx++ ){
          parityByte = parityByte ^ inSjisAllArray[tmpArrIdx];
      }
      console.log("Shift-Jis全文字列のパリティは、10進数で「" + parityByte.toString(10) + "」であり、16進数で「" +  ("00" + parityByte.toString(16)).slice(-2)  + "」です") ;
 
 
      output_utf16_strarr = [];
      
      var inSjisAllArray_len = inSjisAllArray.length;
      
      var max_sjis_char_val_cfg = document.getElementById("max_sjis_char_val_inputted").value ;
      var outQrByteArr = [];
      var outSjisArr = [];
      var outSjisArrIdx = 1;
      var isSjisFirstByteAlreadyRead = false ; 
      var sjisFirstBytePosArr = [] ;
      var sjisSecondBytePosArr = [] ;
      var splitOKBytePosArr_Dec = [] ;
      var splitOKBytePosArr_Hex = [] ;
      var splitOKBytePosArr_HexWithWbr = [] ;
      var splitNGBytePosArr_Dec = [] ;
      var splitNGBytePosArr_Hex = [] ;
      var splitNGBytePosArr_HexWithWbr = [] ;
      var sjisSecondBytePos = -1; 
      var isByteCR = false ;
      var isAbleToSplitAfterThisChar = true;

      var lastSplitChkPos = -1 ;
      var isAbleToSplitInfoArr = [] ;

      for (inSjisArrIdx = 0; inSjisArrIdx < inSjisAllArray_len; inSjisArrIdx++) {

//        console.log("☆ inSjisArrIdx(10進数):" + inSjisArrIdx + " inSjisArrIdx(16進数):" + inSjisArrIdx.toString(16) + " inSjisAllArray[inSjisArrIdx](16進数):" + inSjisAllArray[inSjisArrIdx].toString(16)  + " inSjisAllArray[inSjisArrIdx](10進数):" + inSjisAllArray[inSjisArrIdx].toString(10) + " outSjisArr.length(10進数):" + outSjisArr.length + "max_sjis_char_val_cfg(10進数):" + max_sjis_char_val_cfg ) ;
        if ( inSjisArrIdx >= 159 && inSjisArrIdx <= 159) {
//          console.log("★注意(159から159です: inSjisArrIdx(10進数)" + inSjisArrIdx + " : inSjisArrIdx(16進数)" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ":" + outSjisArr.length ) ;
        }

        if ( isThisByteCR (inSjisAllArray[inSjisArrIdx]) == true ) {
          isAbleToSplitAfterThisChar = false;
        } else if ( sjisSecondBytePos > -1) {
          isAbleToSplitAfterThisChar = false;
        }


        if ( inSjisArrIdx == lastSplitChkPos ) {
        } else {
          // https://qiita.com/mpyw/items/a8dba1b80fe68523b8eb
          // https://www.tohoho-web.com/ex/charset.html
          if ( (inSjisAllArray[inSjisArrIdx]) == parseInt("0D", 16) ) {
            // CR 
            isAbleToSplitInfoArr[ inSjisArrIdx ] = false ;
            lastSplitChkPos = inSjisArrIdx ;
            splitNGBytePosArr_Dec.push(inSjisArrIdx) ;
            splitNGBytePosArr_Hex.push(inSjisArrIdx.toString(16)) ;
            splitNGBytePosArr_HexWithWbr.push(inSjisArrIdx.toString(16) + "<wbr>") ;
          } else if (  (inSjisAllArray[inSjisArrIdx]) >= parseInt("00", 16) && (inSjisAllArray[inSjisArrIdx]) <= parseInt("7F", 16) ) {
            // ASCII
            isAbleToSplitInfoArr[ inSjisArrIdx ] = true ;
            lastSplitChkPos = inSjisArrIdx ;
            splitOKBytePosArr_Dec.push(inSjisArrIdx) ;
            splitOKBytePosArr_Hex.push(inSjisArrIdx.toString(16)) ;
            splitOKBytePosArr_HexWithWbr.push(inSjisArrIdx.toString(16) + "<wbr>") ;
          } else if (  (inSjisAllArray[inSjisArrIdx]) >= parseInt("A1", 16) && (inSjisAllArray[inSjisArrIdx]) <= parseInt("DF", 16) ) {
            // 半角カタカナ
            isAbleToSplitInfoArr[ inSjisArrIdx ] = true ;
            lastSplitChkPos = inSjisArrIdx ;
            splitOKBytePosArr_Dec.push(inSjisArrIdx) ;
            splitOKBytePosArr_Hex.push(inSjisArrIdx.toString(16)) ;
            splitOKBytePosArr_HexWithWbr.push(inSjisArrIdx.toString(16) + "<wbr>") ;
          } else if ((  inSjisAllArray[inSjisArrIdx] >= parseInt("81", 16) && inSjisAllArray[inSjisArrIdx] <= parseInt("9F", 16) ) 
                  || (inSjisAllArray[inSjisArrIdx] >= parseInt("40", 16) && inSjisAllArray[inSjisArrIdx] <= parseInt("FC", 16) ) ) {
                    // Shift-JIS の 1 バイト目の可能性あり。
                  if ((  inSjisAllArray[inSjisArrIdx + 1] >= parseInt("E0", 16) && inSjisAllArray[inSjisArrIdx + 1] <= parseInt("EF", 16) ) 
                  || (inSjisAllArray[inSjisArrIdx + 1] >= parseInt("40", 16) && inSjisAllArray[inSjisArrIdx + 1] <= parseInt("FC", 16) ) ) {
                      // Shift-JIS の 2 バイト目である。
                      isAbleToSplitInfoArr[ inSjisArrIdx ] = false ;
                      splitNGBytePosArr_Dec.push(inSjisArrIdx) ;
                      splitNGBytePosArr_Hex.push(inSjisArrIdx.toString(16)) ;
                      splitNGBytePosArr_HexWithWbr.push(inSjisArrIdx.toString(16) + "<wbr>") ;
                      isAbleToSplitInfoArr[ inSjisArrIdx + 1 ] = true ;
                      splitOKBytePosArr_Dec.push(inSjisArrIdx + 1) ;
                      splitOKBytePosArr_Hex.push(inSjisArrIdx.toString(16)) ;
                      splitOKBytePosArr_HexWithWbr.push(inSjisArrIdx.toString(16) + "<wbr>") ;
                      lastSplitChkPos = inSjisArrIdx + 1 ;
                  }
          } else {
            isAbleToSplitInfoArr[ inSjisArrIdx ] = true ;
            lastSplitChkPos = inSjisArrIdx ;
            splitOKBytePosArr_Dec.push(inSjisArrIdx) ;
            splitNGBytePosArr_Hex.push(inSjisArrIdx.toString(16)) ;
            splitOKBytePosArr_HexWithWbr.push(inSjisArrIdx.toString(16) + "<wbr>") ;
          }
        }


        if ( inSjisArrIdx == 4 ) {
//          console.log("inSjisArrIdx == 4") ;
        }
//        console.log("★タイプ0A-1 outSjisArr を作成してにコピー)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
        if (inSjisArrIdx >= inSjisAllArray_len)  {
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
            outQrByteArr.push(outSjisArr);
            outSjisArr = []; 
            isSjisFirstByteAlreadyRead = false ;
            isAbleToSplitAfterThisChar = true ;
//            console.log("★タイプ1 (入力元のバッファがもう終わる)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
        } else if (outSjisArr.length >= max_sjis_char_val_cfg) {
          if ( isAbleToSplitInfoArr[ inSjisArrIdx ] == false ) {
//            console.log("★タイプ2A-1 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split NG)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
            outQrByteArr.push(outSjisArr);
//            console.log("★タイプ2A-2 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split NG)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
            outSjisArr = []; 
//            console.log("★タイプ2A-3 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split NG)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
//            console.log("★タイプ2A-4 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split NG)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
          } else {
//            console.log("★タイプ2B-1 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split OK)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
            outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
//            console.log("★タイプ2B-2 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split OK)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
            outQrByteArr.push(outSjisArr);
//            console.log("★タイプ2B-3 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split OK)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
            outSjisArr = []; 
//            console.log("★タイプ2B-4 (出力先 outSjisArr の最終バイトにコピーしようとしたが、split OK)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
          }
        } else {
//          console.log("★タイプ3A-1 (まだ余裕があるので split OK/NG を気にせず push )" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
          outSjisArr.push(inSjisAllArray[inSjisArrIdx]);
//          console.log("★タイプ3A-2 (まだ余裕があるので split OK/NG を気にせず push )" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
        }

        if (inSjisArrIdx >= inSjisAllArray_len - 1)  {
            outQrByteArr.push(outSjisArr);
//            console.log("★タイプ1 (入力元のバッファがもう終わる)" + ": inSjisArrIdx=" + inSjisArrIdx + ": inSjisArrIdx.toString(16)=" + inSjisArrIdx.toString(16) + ": inSjisAllArray[inSjisArrIdx].toString(16)=" + inSjisAllArray[inSjisArrIdx].toString(16) + ": outSjisArr.length=" + outSjisArr.length + ": outQrByteArr.length=" + outQrByteArr.length + ": isAbleToSplitInfoArr[ inSjisArrIdx ]=" + isAbleToSplitInfoArr[ inSjisArrIdx ]) ;
        }

      }

      var html_str = "";
      var html_str = "";
//      html_str = html_str + "<table border='1' cellspacing='0'>";
      html_str = html_str + "<table border='1' cellspacing='0'>";
      
      var outUtf16Arr = [];
      var outDivQrAllByteArr_SJis = [] ;
      var outDivQrStrArr_Utf16 = [] ;
      var qrArrMaxNbr = outQrByteArr.length;

      var qrHeaderStrArr = [] ;
      for (outQrArrIdx = 0; outQrArrIdx < qrArrMaxNbr; outQrArrIdx++) {
        var tmpSjisArr2 = outQrByteArr[outQrArrIdx];
        var tmpArr = Encoding.convert(outQrByteArr[outQrArrIdx], {
          to: 'UNICODE', 
          from:  'SJIS'
        });
        var qrStrUtf16 = Encoding.codeToString(tmpArr);
        
        // https://qiita.com/megadreams14/items/dded3cf770010bb8ff08
        // 3バイト (0, 1, 2) のバッファ領域を確保
        let buffer = new ArrayBuffer(3);        
        // バッファに対してデータの書き込みが出来るようにDataViewクラスを初期化
        let dv = new DataView(buffer);
        // 0バイト目に30をセット
//        dv.setUint8(0, 30);

        // https://programresource.net/2013/05/04/2188.html
        var divQrTypeCdStr = "3" ; // QRコードのヘッダーの0バイト目左4bitが「3」であれば連結コード
        var curQrIdxStr = outQrArrIdx.toString(16); // QRコードのヘッダーの0バイト目右4bitは連結内コード連番 (0開始)

        var byte0TmpChar = + divQrTypeCdStr + curQrIdxStr; // 1つめなら「30」
        var byte0Str = "0x" + divQrTypeCdStr + curQrIdxStr;
//        var byte0TmpByte = parseInt(byte0Str,16);
        var byte0TmpByte = parseInt(byte0Str,16).toUpperCase;
        dv.setUint8(0, byte0TmpByte);
        var qrMaxIdxStr = (qrArrMaxNbr -1).toString(16); // QRコードのヘッダー連結内コード連番最大値 (最大は0x0d (16))
        var parityByte2CharsInHex = ("00" + parityByte.toString(16)).slice(-2);
        var parityByteHex1 = parityByte2CharsInHex.substr(0, 1);
        var parityByteHex2 = parityByte2CharsInHex.substr(1, 1);
        var byte1Str = "0x" + qrMaxIdxStr + parityByteHex1;
        dv.setUint8(1, byte1Str);
        var encodingTypeStr = "4" ;
        var byte2Str = "0x" + parityByteHex2 + encodingTypeStr;
        dv.setUint8(2, byte2Str);

        var bytesTmpStr = "";
        
        const yenMarkStr = "\\";

        var inSjisLen = inSjisAllArray_len;
//        var inSjisAllArraylenHexWithout0Padding = inSjisAllArraylenDec;
//        var inSjisAllArraylenHexWithout0Padding = inSjisAllArraylenDec.toString(16);
//        var inSjisAllArraylenHexWithout0Padding = inSjisLen.toString(16);
        var inSjisLenHexWithoutPadding = "";
        inSjisLenHexWithoutPadding =inSjisLen.toString(16);
        var inSjisAllArraylenHex = ("0000" + inSjisLenHexWithoutPadding).slice(-4);
//        var qrHeaderStr = "\u{30}" ;
        var qrHeaderStr = yenMarkStr + "u{" + divQrTypeCdStr + curQrIdxStr +"}" ;
        qrHeaderStr = qrHeaderStr +  yenMarkStr + "u{" + qrMaxIdxStr + parityByteHex1 +"}" ;
        qrHeaderStr = qrHeaderStr +  yenMarkStr + "u{" + parityByteHex2 + encodingTypeStr +"}" ;
//        qrHeaderStr = qrHeaderStr +  yenMarkStr + "u{" + inSjisAllArraylenHex +"}" ;
        qrHeaderStr = qrHeaderStr +  yenMarkStr + "u{" + inSjisAllArraylenHex.toUpperCase +"}" ;
//        qrHeaderStr = "" + curQrIdxStr.toString(16) + (qrArrMaxNbr -1).toString(16) + "30";
//        qrHeaderStr = "" + curQrIdxStr.toString(16) + (qrArrMaxNbr -1).toString(16) + parityByte2CharsInHex;
        qrHeaderStr = "" + curQrIdxStr.toString(16) + (qrArrMaxNbr -1).toString(16) + parityByte2CharsInHex;
        console.log("★★★★qrHeaderStr..." + qrHeaderStr);
//        qrHeaderStr = dv.getUint8(0).toString(16) + dv.getUint8(1).toString(16) + dv.getUint8(2).toString(16) + "0200"; 
//        qrHeaderStr = ""; 
        qrHeaderStrArr.push(qrHeaderStr);
/*
        var toAddQrHeaderStr = document.getElementById("addQrHeader").value;
        var toAddQrHeaderInt = parseInt(toAddQrHeaderStr, 10);
        if ( toAddQrHeaderInt == 0 ) {
          qrStrUtf16 = qrHeaderStr + qrStrUtf16; 
        }
*/


        //          if ( max_sjis_char_val_cfg < 41 ) {
        if ( 1 == 1 ) {
//          for ( idx = 0; idx <= max_sjis_char_val_cfg ; idx++ ){
          var tdStartTag = "<td id=\"divOneQrSjisHexStrCol" + outQrArrIdx + "\" width=\"30%\">" ;
          var divOneQrSjisHexStrVal_01Org = "" ;
          var divOneQrSjisHexStrVal_02_ForDispInHtmlWeb = "" ;
          for ( idx = 0; idx <= tmpSjisArr2.length ; idx++ ){
            if ( idx < tmpSjisArr2.length ) {
              var tmpChr123 = ("00" + tmpSjisArr2[idx].toString(16)).slice(-2);
              divOneQrSjisHexStrVal_01Org = divOneQrSjisHexStrVal_01Org + "" + tmpChr123 + ""; 
              divOneQrSjisHexStrVal_02_ForDispInHtmlWeb = divOneQrSjisHexStrVal_02_ForDispInHtmlWeb + "" + tmpChr123 + "<wbr>";
            } else {
              divOneQrSjisHexStrVal_01Org = divOneQrSjisHexStrVal_01Org + "" + "" + "";
              divOneQrSjisHexStrVal_02_ForDispInHtmlWeb = divOneQrSjisHexStrVal_02_ForDispInHtmlWeb + "" + tmpChr123 + "<wbr>";
            }
          }
          var tdEndtTag = "</td>" ;
          var divOneQrSjisHexStrColHtmlStr = tdStartTag + divOneQrSjisHexStrVal_02_ForDispInHtmlWeb + tdEndtTag ;
        } else {
          // ("00" + parityByte.toString(16)).slice(-2)
          bytesTmpStr = bytesTmpStr + "<td>" + dv.getUint8(0).toString(16) + "</td>";
          bytesTmpStr = bytesTmpStr + "<td>" + dv.getUint8(1).toString(16) + "</td>";
          bytesTmpStr = bytesTmpStr + "<td>" + dv.getUint8(2).toString(16) + "</td>";
          for ( idx = 0; idx <= 19 ; idx++ ){
            if ( idx < tmpSjisArr2.length ) {
              bytesTmpStr = bytesTmpStr + "<td>" + tmpSjisArr2[idx].toString(16) + "</td>";
            } else {
              bytesTmpStr = bytesTmpStr + "<td>" + "" + "</td>";
            }
          }
        }

        var divOneQrSjisArr = [];
        for ( divOneQrSjisArrIdx = 0; divOneQrSjisArrIdx <= divOneQrSjisHexStrVal_01Org.length; divOneQrSjisArrIdx = divOneQrSjisArrIdx + 2 ) {
          divOneQrSjisArr[divOneQrSjisArrIdx] = "0x" + divOneQrSjisHexStrVal_01Org.substr(divOneQrSjisArrIdx, 2)
        }
        outDivQrAllByteArr_SJis.push(divOneQrSjisArr);
        /*
        for (tmpOutArrIdx = 0; tmpOutArrIdx < tmpSjisArr.length; tmpOutArrIdx++) {
          bytesTmpStr = bytesTmpStr + " " + tmpSjisArr[tmpOutArrIdx].toString(16) + "";
        }
*/        
        var  qrArrMaxNbr0orig =  qrArrMaxNbr - 1 ;
/*
        var outDivQrStrWithHeader = qrHeaderStr + outDivQrStrWithoutHeader;
        outDivQrStrArr.push(outDivQrStrWithHeader);
*/
//        var outDivQrStrWithHeader = outDivQrStrWithoutHeader;
//★★
//addQrHeader
/*
        var toAddQrHeaderStr = document.getElementById("addQrHeader").value;
        var toAddQrHeaderInt = parseInt(toAddQrHeaderStr, 10);
        console.log("qrHeaderStr = " + qrHeaderStr ) ;
        console.log("qrStrUtf16 = "+ qrStrUtf16 ) ;
        if ( toAddQrHeaderInt == 0 ) {
          qrStrUtf16 = qrHeaderStr + qrStrUtf16; 
        }
*/
        outDivQrStrArr_Utf16.push(qrStrUtf16);


        //        html_str = html_str + "<tr><td>" + tmpStr + "</td><td>" + bytesTmpStr + "</td><td>"; 
        html_str = html_str + "<tr><td width=\"20%\">" + qrStrUtf16 + "</td>" + divOneQrSjisHexStrColHtmlStr ; 
        html_str = html_str + "<td>" + tmpSjisArr2.length + " バイト  (SJIS) </td><td>" + outQrArrIdx +"/" + qrArrMaxNbr0orig + "</td>";
        html_str = html_str + "<td>" + outQrArrIdx.toString(16) +"/" + qrArrMaxNbr0orig.toString(16) + "</td>" ; 
        html_str = html_str + "<td><div id=\"idimg-divqr" + outQrArrIdx + "\"></div></td>" ; 
        html_str = html_str + "<td>(余白)</td>";
        html_str = html_str + "</tr>\n";

        html_str = html_str + "<tr><td>(余白)</td><td>"; 
          for ( idx = 0; idx <= 19 ; idx++ ){
            html_str = html_str + "<td>" + "" + "</td>";
            }
        html_str = html_str +   "</td><td>"; 
        html_str = html_str + "</td><td>(余白) " + outQrArrIdx +"/" + qrArrMaxNbr0orig + "</td>";
        html_str = html_str + "<td></td>" ; 
        html_str = html_str + "<td></td>" ; 
        html_str = html_str + "<td>(余白)</td>";
        html_str = html_str + "</tr>\n";

      }
      html_str = html_str + "</table>\n";
      var splitOKarrList = splitOKBytePosArr_HexWithWbr.join(",");
      html_str = html_str + "OK一覧" + splitOKarrList + "<br>\n";
      var splitNGarrList = splitNGBytePosArr_HexWithWbr.join(",");
      html_str = html_str + "NG一覧" + splitNGarrList + "<br>\n";
//      document.getElementById("div_qr_output_area01").innerHTML = html_str;

  var html_str2 ="";
  html_str2 = html_str2 + "<table border='1' cellspacing='0'>\n";

sjisStrArr = [];

  for (wkDivQrIdx = 0; wkDivQrIdx < outDivQrStrArr_Utf16.length; wkDivQrIdx++ ) {
    const yenMarkStr = "\\";
    var divQrTypeCdStr = "3" ; // QRコードのヘッダーの0バイト目左4bitが「3」であれば連結コード
    var encodingTypeStr = "4" ;


    var qrHeaderStr = yenMarkStr + "u{" + divQrTypeCdStr + wkDivQrIdx +"}" ;
        qrHeaderStr = qrHeaderStr +  yenMarkStr + "u{" + wkDivQrIdx + parityByteHex1 +"}" ;
        qrHeaderStr = qrHeaderStr +  yenMarkStr + "u{" + parityByteHex2 + encodingTypeStr +"}" ;

        qrHeaderStr = "" + wkDivQrIdx.toString(16) + (outDivQrStrArr_Utf16.length -1).toString(16) + parityByte2CharsInHex;

    var firstbyteChar = "" ;
    if (wkDivQrIdx < 10) {
      firstbyteChar = wkDivQrIdx ;
    } else {
      switch (wkDivQrIdx) {
        case 10:
//          firstbyteChar = ":";
          firstbyteChar = "A";
          break;
        case 11:
//        firstbyteChar = ";";
          firstbyteChar = "B";
          break;
        case 12:
//        firstbyteChar = "<";
          firstbyteChar = "C";
          break;
        case 13:
//        firstbyteChar = "=";
          firstbyteChar = "D";
          break;
        case 14:
//        firstbyteChar = ">";
          firstbyteChar = "E";
          break;
        case 15:
//        firstbyteChar = "?";
          firstbyteChar = "F";
          break;
        defalult:
          break;
      }
    }
    var secondbyteTempChar = "" ;
    var secondbyteChar = "" ;
    secondbyteTempChar = (outDivQrStrArr_Utf16.length - 1 ).toString(16) ;
    secondbyteChar = secondbyteTempChar.toUpperCase() ;
//    qrHeaderStr = "" + wkDivQrIdx.toString(16) + (outDivQrStrArr_Utf16.length -1).toString(16) + parityByte2CharsInHex.toUppserCase;
    qrHeaderStr = "" + firstbyteChar + secondbyteChar + parityByte2CharsInHex.toUpperCase() ;


    var curUtf16Str = outDivQrStrArr_Utf16[wkDivQrIdx] ;
//    var b0Char = "0424";
    html_str2 = html_str2 + "<tr>";
    html_str2 = html_str2 + "<td>" + htmlspecialchars(qrHeaderStr) + "</td>";
    curUtf16Str = qrHeaderStr + curUtf16Str;
//    console.log("" + curUtf16Str ) ;
    html_str2 = html_str2 + "<td>" + htmlspecialchars(curUtf16Str) + "</td>";
    var source = Encoding.convert(curUtf16Str, 'SJIS');
    sjisStrArr.push(source) ;
    html_str2 = html_str2 + "<td>" + source.length + " バイト  (SJIS) </td><td>" + wkDivQrIdx +"/" + (outDivQrStrArr_Utf16.length - 1) + "</td>";
//    console.log("★★\u{30}\u{46}\u{44}\u{000f4}" ) ;
//    var source = Encoding.convert("\u{48}\u{35}\u{4A}\u{1176}" + curUtf16Str, 'SJIS');
    html_str2 = html_str2 + "<td><div id=\"idimg_divqrx_" + wkDivQrIdx + "\"></div></td>" ; 
    html_str2 = html_str2 + "<td>(余白)</td>";
    html_str2 = html_str2 + "</tr>\n";
    html_str2 = html_str2 + "<tr><td></td><td>";
    if (wkDivQrIdx - 2 >= 0) {
      html_str2 = html_str2 + "<a href=\"#idimg_divqrx_" + (wkDivQrIdx - 2) + "\"\">2つ前のQRに移動</a> ";
    } else {
      html_str2 = html_str2 + "2つ前のQRに移動 ";
    }
    if (wkDivQrIdx - 1 >= 0) {
      html_str2 = html_str2 + "<a href=\"#idimg_divqrx_" + (wkDivQrIdx - 1) + "\"\">1つ前のQRに移動</a> ";
    } else {
      html_str2 = html_str2 + "1つ前のQRに移動 ";
    }
    if (wkDivQrIdx + 1 < outDivQrStrArr_Utf16.length) {
      html_str2 = html_str2 + "<a href=\"#idimg_divqrx_" + (wkDivQrIdx + 1) + "\"\">1つ次のQRに移動</a> ";
    } else {
      html_str2 = html_str2 + "1つ次のQRに移動 ";
    }
    if (wkDivQrIdx + 2 < outDivQrStrArr_Utf16.length) {
      html_str2 = html_str2 + "<a href=\"#idimg_divqrx_" + (wkDivQrIdx + 2) + "\"\">2つ次のQRに移動</a> ";
    } else {
      html_str2 = html_str2 + "2つ次のQRに移動 ";
    }
    html_str2 = html_str2 + "データ部の文字の長さ (sjis) 「" + source.length + "」"
    html_str2 = html_str2 + "(QRコード読み取りエラー防止のための余白)</td>";
    html_str2 = html_str2 + "<td></td>";
    html_str2 = html_str2 + "<td>(余白)</td>";
    html_str2 = html_str2 + "</tr>\n";

    var toAddQrHeaderStr = document.getElementById("addQrHeader").value;
    var toAddQrHeaderInt = parseInt(toAddQrHeaderStr, 10);
//    console.log("qrHeaderStr = " + qrHeaderStr ) ;
//    console.log("source = "+ source ) ;
/*
    if ( toAddQrHeaderInt == 0 ) {
      source = qrHeaderStrArr[wkDivQrIdx] + source; 
    }
*/
    //    console.log("★wkDivQrIdx = " + wkDivQrIdx + " qrUtf16str = " + qrUtf16str ) ;
    // https://qiita.com/okoppe8/items/faf67e4294661a5df803
/*
    qrHeaderStrUtf16 ="\u{30}\u{53}\u{74}\u{0498}" ;
    var qrHeaderStrSjis = Encoding.convert(qrHeaderStrUtf16, 'SJIS');
    console.log("qrHeaderStrSjis = " + qrHeaderStrSjis ) ;
    source = qrHeaderStrSjis + source ;
 */
//    $("#idimg-divqr" + wkDivQrIdx).qrcode({width:300,height:300,text:source});
//    $("#idimg-divqr" + wkDivQrIdx).qrcode({width:300,height:300,text:source});
//    $("#idimg_divqrx_" + wkDivQrIdx).qrcode({width:300,height:300,text:source});
  }
  document.getElementById("div_qr_output_area02").innerHTML = html_str2;
  for (let j = 0; j < sjisStrArr.length; j++) {
    $("#idimg_divqrx_" + j).qrcode({width:300,height:300,text:sjisStrArr[j]});
  }
  document.getElementById('concatcsv_genqr_proc_status2').innerHTML = "<p>CSV作成とQRコード作成処理が完了しました。</p>";


      //      var sjisStr = Encoding.codeToString(sjisAllArray)
//      sjisStrArr.push(sjisStr);

}
</script>




  

<script>
// https://qiita.com/mpyw/items/a8dba1b80fe68523b8eb
function isPossibleThisCharIsTheFirstByteOfSJis(byte) {
  if ( byte >= parseInt("81", 16) && byte <= parseInt("9F", 16)) {
    return true;
  } else if ( byte >= parseInt("40", 16) && byte <= parseInt("FC", 16)) {
    return true;
  } else {
    return false;
  }
}
</script>
<script>
  // https://qiita.com/mpyw/items/a8dba1b80fe68523b8eb
  function isPossibleThisCharIsTheSecondByteOfSJis(byte) {
    if ( byte >= parseInt("E0", 16) && byte <= parseInt("EF", 16)) {
      return true;
    } else if ( byte >= parseInt("40", 16) && byte <= parseInt("FC", 16)) {
      return true;
    } else {
      return false;
    }
  }
  </script>
  
<script>
  function isThisByteCR(byte) {
    if ( byte == parseInt("0D", 16)) {
      return true;
    } else {
      return false;
    }
  }
</script>

<!--
  medicineinfo_concat_qrcode_create_type03
  medicineinfo_div_qr_create03
-->
<script>
  function medicineinfo_concat_qrcode_create_type03() {
  
    document.getElementById('concatcsv_genqr_proc_status03').innerHTML = "<p>処理実行中。しばらくお待ちください…</p>";
  
  
    var drugnote_tmp_arr = [] ;
  
    var varec_arr = [];
  //  varec_arr.push(document.getElementsByClassName('verrec_verinfo').value);
  //  varec_arr.push(document.getElementsByClassName('verrec_outputtype').value);
  
    varec_arr.push(varrec_verinfo);
  //  concole.log ("verrec_outputtype = " + document.getElementsByClassName('verrec_outputtype').item(0).value);
    varec_arr.push(document.getElementsByClassName('verrec_outputtype').item(0).value);
  
    var varec_str = varec_arr.join(',');
  //  varec_arr.push(varec_str);
  
  
  //  drugnote_tmp_arr.push(varec_arr);
  //  drugnote_tmp_arr.push(document.getElementById("medicineinfo_part01").value);
    drugnote_tmp_arr.push(document.getElementById("textarea_medicineinfo_part02_type03").value);
    if (document.getElementById("textarea_medicineinfo_part02_type03").value.length > 0) {
      var drugnote_str = drugnote_tmp_arr.join("\n");
    } else {
      // var drugnote_str = document.getElementById("textarea_medicineinfo_part02_type01").value;
    }
//    document.getElementById("medicineinfo_type03_concatted").value = drugnote_str;
    document.getElementById("medicineinfo_type03_concatted").value = drugnote_str;
    
    var drugnote_allarr = [] ;
    drugnote_allarr = drugnote_str.split("\n");
  
  
    var output_arr = [] ;
    var oneqrdat_arr = [];
    var oneqrdat_idx = 1;
  
    var org_utf16_str = "";
    
  
    // https://mekou.com/linux-magazine/javascript%E3%81%A7%E7%8F%BE%E5%9C%A8%E6%99%82%E5%88%BB%E3%82%92yyyymmddhhmmss%E3%81%A7%E5%87%BA%E5%8A%9B%E3%81%99%E6%96%B9%E6%B3%95/
    var chozai_date = new Date();
    console.log(chozai_date.getFullYear() + '/' + ('0' + (chozai_date.getMonth() + 1)).slice(-2) + '/' +('0' + chozai_date.getDate()).slice(-2) + ' ' +  ('0' + chozai_date.getHours()).slice(-2) + ':' + ('0' + chozai_date.getMinutes()).slice(-2) + ':' + ('0' + chozai_date.getSeconds()).slice(-2) + '.' + chozai_date.getMilliseconds());
  //92345678901234
  //yyyymmddhhmmss
    var csvsplit_rec_number = 911;
  //  var csvsplit_dat_unique_id = 12345678901234;
  // var csvsplit_dat_unique_id = 92345678901234;
  if (document.getElementsByClassName('dispensing_date_info_rec_date_of_dispensing').item(0).value != "" ) {
    var chozai_ymd = document.getElementsByClassName('dispensing_date_info_rec_date_of_dispensing').item(0).value;
  } else {
    var chozai_ymd = chozai_date.getFullYear() + ('0' + (chozai_date.getMonth() + 1)).slice(-2) + ('0' + chozai_date.getDate()).slice(-2);
  }
   var csvsplit_dat_unique_id = chozai_ymd + ('0' + chozai_date.getHours()).slice(-2) + ('0' + chozai_date.getMinutes()).slice(-2) + ('0' + chozai_date.getSeconds()).slice(-2);
  //  var csvsplit_dat_unique_id = 20220706225100 ;
    var csvsplit_maxnum = 0;
    var csvsplit_idx = 1;
  
    var tmp_utf16_str = varec_str; // csv を複数に分割する際、1行目はヘッダを付与する
    var tmp_utf16_str_len = 0;
    var tmp2_utf16_str = "";
    var tmp3_utf16_str = "";
    var tmp4_utf16_str = "";
  
    const varrec_const = "JAHISTC";
    reg = new RegExp(varrec_const);

    var rec301cnt = 0 ;
    var rec301cnt_per_one_qr = 0 ;
  
    for (let i = 0; i < drugnote_allarr.length; ++i) {
  //    console.log("drugnote_allarr[" + i+ "]=" + drugnote_allarr[i]);
  //    console.log("tmp_utf16_str=" + tmp_utf16_str);
  //    console.log("tmp_utf16_str.length=" + tmp_utf16_str.length);
      tmp_str_utf16_len = tmp_utf16_str.length;
      var recnbr_str = "" ;
    
  //    if (drugnote_allarr[i].match(reg)) {
      if (drugnote_allarr[i].match(reg)) {
        ; // 行に「JAHISTC」を含んでいる場合は、その行を読み飛ばす
      } else {
        ; // 行に「JAHISTC」を含んでいない場合は、分割 CSV に出力する。
        // ★
        var max_utf16_char_val_cfg = document.getElementById("max_utf16_char_val_inputted").value ;
        
        if ( i + 1 <= drugnote_allarr.lenth ) {
          tmp2_utf16_str = tmp_utf16_str + drugnote_allarr[i + 1] ;
          tmp3_utf16_str = drugnote_allarr[i + 1] ;
        } else {
          tmp2_utf16_str = tmp_utf16_str ;
          tmp3_utf16_str = "" ;
        }
        tmp4_utf16_str = drugnote_allarr[i] ;
  //      if (tmp_utf16_str.length > max_utf16_char_val_cfg) {
        var nextline_recnbr = "" ;
//        if ( i + 1 <= drugnote_allarr.length ) {
        if ( i + 1 < drugnote_allarr.length ) {
          nextline_recnbr = drugnote_allarr[i + 1].substring(-1,3) ;
        } else {
          nextline_recnbr = "" ;
        }
        var curline_recnbr = "" ;
        if ( i < drugnote_allarr.length ) {
          curline_recnbr = drugnote_allarr[i].substring(-1,3) ;
        } else {
          curline_recnbr = "" ;
        }
        var prevline_recnbr = "" ;
        if ( i - 1 >= 0 && i < drugnote_allarr.length ) {
          prevline_recnbr = drugnote_allarr[ i - 1 ].substring(-1,3) ;
        } else {
          prevline_recnbr = "" ;
        }
        var onerow_colarr = [] ;
        onerow_colarr = drugnote_allarr[ i ].split(",") ;
//        var recnbr_str = "" ;
        if ( onerow_colarr[0].length >= 6 ) {
          if ( onerow_colarr[0].substring(-1, 6) === "JAHIST" ) {
            recnbr_str = "JAHIST" ;
          } else {
//            recnbr_str = onerow_colarr[0].toString ;
            recnbr_str = onerow_colarr[0] ;
          }
        } else {
//          recnbr_str = onerow_colarr[0].toString ;
          recnbr_str = onerow_colarr[0] ;
        }
//          const matsumoto_kiyoshi_recnbr_arrr_for_qr_output = [ "JAHIST", "1", "5", "11", "15", "51", "55", "201", "281", "291", "301" ] ;

        }
        if ( prevline_recnbr === "301" ) {
          rec301cnt = rec301cnt + 1 ;
          rec301cnt_per_one_qr = ( rec301cnt % 1) ; // 1 つの QR コードに 301 レコードを 2 つ含む
        }
//        if (prevline_recnbr === "301" || prevline_recnbr === "311" || tmp2_utf16_str.length > max_utf16_char_val_cfg || tmp3_utf16_str.length >= 106 || tmp4_utf16_str.length >= 106) {
//      if (prevline_recnbr === "301" || tmp2_utf16_str.length > max_utf16_char_val_cfg || tmp3_utf16_str.length >= 106 || tmp4_utf16_str.length >= 106) {
//        if ( ( prevline_recnbr === "301" && rec301cnt > 0 && rec301cnt_per_one_qr === 0 ) || tmp2_utf16_str.length > max_utf16_char_val_cfg || tmp3_utf16_str.length >= 106 || tmp4_utf16_str.length >= 106) {
//      if (prevline_recnbr === "301" || tmp2_utf16_str.length > max_utf16_char_val_cfg || tmp3_utf16_str.length >= 106 || tmp4_utf16_str.length >= 106) {
  if ( ( prevline_recnbr === "301" && rec301cnt > 0 && rec301cnt_per_one_qr === 0 ) || tmp2_utf16_str.length > max_utf16_char_val_cfg || tmp3_utf16_str.length >= 106 || tmp4_utf16_str.length >= 106) {
          oneqrdat_arr.push(tmp_utf16_str);
  //        console.log("oneqrdat_arr.push(tmp_utf16_str)" + tmp_utf16_str)
          tmp_utf16_str = varec_str; // csv を複数に分割する際、1行目はヘッダを付与する
          // csv を複数に分割する際、2行目はダミーデータ (K群お薬手帳専用) を付与する
          tmp_utf16_str = tmp_utf16_str + "\n" + "15,(薬剤師名なし),(住所なし(K群お薬手帳読み込みエラー回避のためのダミーデータの行)),2" ; 
             tmp_utf16_str = tmp_utf16_str + "\n" + drugnote_allarr[i] ;
  } else {
          if (tmp_utf16_str.length > 0) {
          //  if  ( matsumoto_kiyoshi_recnbr_arrr_for_qr_output.includes(recnbr_str) ) {
          //    tmp_utf16_str = tmp_utf16_str + "\n" + drugnote_allarr[i] ;
          //  }
          //if ( recnbr_str === "JAHIST" || recnbr_str === "1" || recnbr_str === "5" || recnbr_str === "11" || recnbr_str === "15" || recnbr_str === "51" || recnbr_str === "55" || recnbr_str === "201" || recnbr_str === "281" || recnbr_str === "291" || recnbr_str === "301" ) {
            tmp_utf16_str = tmp_utf16_str + "\n" + drugnote_allarr[i] ;
          //}
  //          console.log("tmp_utf16_str=" + tmp_utf16_str)
  //          console.log("tmp_utf16_str.length=" + tmp_utf16_str.length)
          } else {
          //  if  ( matsumoto_kiyoshi_recnbr_arrr_for_qr_output.includes(recnbr_str) ) {
          //    tmp_utf16_str = drugnote_allarr[i] ;
          //  }
            tmp_utf16_str = drugnote_allarr[i] ;
  //          console.log("tmp_utf16_str=" + tmp_utf16_str)
  //          console.log("tmp_utf16_str.length=" + tmp_utf16_str.length)
          }
        }
    //}
      
      if (i + 1 >= drugnote_allarr.length) {
        oneqrdat_arr.push(tmp_utf16_str);
  //      console.log("oneqrdat_arr.push(tmp_utf16_str)" + tmp_utf16_str)
      }
      csvsplit_maxnum = oneqrdat_arr.length;
      // 2023/04/11
    //}
    }
  
    for (let k = 0; k < oneqrdat_arr.length; ++k) {
      csvsplit_idx = k + 1;
      var csvsplit_rec_arr = [];
      csvsplit_rec_arr.push(csvsplit_rec_number);
      csvsplit_rec_arr.push(csvsplit_dat_unique_id);
      csvsplit_rec_arr.push(csvsplit_maxnum);
      csvsplit_rec_arr.push(csvsplit_idx);
      var csvsplit_rec_str = csvsplit_rec_arr.join(',');
      // 2023/04/10 911レコードを省略 (K群お薬手帳対応)
      oneqrdat_arr[k] = oneqrdat_arr[k] + "\n" + csvsplit_rec_str;
    }
  
    var html_str = ""; 
    if (oneqrdat_arr.length > 0) {
      html_str = html_str + "<a href=\"#idimg-qr" + (0) + "\"\">1つ目のQRに移動</a><br>\n";
      html_str = html_str + "<a href=\"#idimg-qr" + (oneqrdat_arr.length - 1) + "\"\">最後 (" + oneqrdat_arr.length + "個目) のQRに移動</a><br>\n";
    }
  
    html_str = html_str + '<table border="1" cellspacing="0">';
    html_str = html_str + "<tr><th>分割された CSV ファイルの内容</th>";
    html_str = html_str + "<th>n 番目/全 n 個</th>";
    html_str = html_str + '<th>QRコード</th>';
    html_str = html_str + '<th>(余白)</th>';
    html_str = html_str +  "</tr>\n";
    var sjisStrArr = [] ;
    for (let j = 0; j < oneqrdat_arr.length; ++j) {
        var qrtext = oneqrdat_arr[j].replace(/\n/g, '\r\n');
        var unicodeArray = Encoding.stringToCode(qrtext); // 文字列から文字コード値の配列に変換
        sjisArray = [] ;
        var sjisArray = Encoding.convert(unicodeArray, {
          to: 'SJIS', 
          from: 'UNICODE' 
        });
        var sjisStr = Encoding.codeToString(sjisArray)
        sjisStrArr.push(sjisStr);
  //      let x = 0;
  //      let idbasenm = "idimg-qr"
  //      $('div').attr("id", _ => idbasenm + x++);
        $("#idimg_type03_qr" + j).qrcode({width:200,height:200,text:"https://wwww.google.co.jp/"});
  //    jquery("#idimg-qr" + j).qrcode("https://wwww.google.co.jp/");
  
      html_str = html_str + "<tr><td>" + oneqrdat_arr[j].replace(/\n/g, "<br>\n") + "</td>";
      html_str = html_str + "<td>" + (j + 1) + " 番目/全 " + (oneqrdat_arr.length) + " 個</td>";
      html_str = html_str + '<td><div id="idimg_type03_qr' + j + '"></div>';
      html_str = html_str + '<td>(余白)</div>';
      html_str = html_str +  "</tr>\n";
  
      html_str = html_str + "<tr><td>";
      if (j - 2 >= 0) {
        html_str = html_str + "<a href=\"#idimg_type03_qr" + (j - 2) + "\"\">2つ前のQRに移動</a> ";
      } else {
        html_str = html_str + "2つ前のQRに移動 ";
      }
      if (j - 1 >= 0) {
        html_str = html_str + "<a href=\"#idimg_type03_qr" + (j - 1) + "\"\">1つ前のQRに移動</a> ";
      } else {
        html_str = html_str + "1つ前のQRに移動 ";
      }
      if (j + 1 < oneqrdat_arr.length) {
        html_str = html_str + "<a href=\"#idimg_type03_qr" + (j + 1) + "\"\">1つ次のQRに移動</a> ";
      } else {
        html_str = html_str + "1つ次のQRに移動 ";
      }
      if (j + 2 < oneqrdat_arr.length) {
        html_str = html_str + "<a href=\"#idimg_type03_qr" + (j + 2) + "\"\">2つ次のQRに移動</a> ";
      } else {
        html_str = html_str + "2つ次のQRに移動 ";
      }
      html_str = html_str + "データ部の文字の長さ (utf16) 「" + oneqrdat_arr[j].length + "」"
      html_str = html_str + "(QRコード読み取りエラー防止のための余白)</td>";
      html_str = html_str + "<td></td>";
      html_str = html_str + "<td>(余白)</td>";
      html_str = html_str + "</tr>\n";
    }
    html_str = html_str + "</table>\n";
    document.getElementById("lastoutput03").innerHTML = html_str;
    for (let j = 0; j < oneqrdat_arr.length; ++j) {
      $("#idimg_type03_qr" + j).qrcode({width:300,height:300,text:sjisStrArr[j]});
    }
  
    document.getElementById('concatcsv_genqr_proc_status03').innerHTML = "<p>CSV作成とQRコード作成処理が完了しました。</p>";
  
  //  medicineinfo_div_qr_create();
  
    return;
  }
  </script>
  


<!--
<h2>3-1. 患者・薬局・薬剤師・医療機関・医師に関する情報</h2>

<p>この時点では、バージョンレコード (例、「JAHISTC07,2」) などは含みません。(後で付加します)</p>

<div>
<input type="button" value="3-1. 患者・薬局・薬剤師・医療機関・医師に関する情報を csv に出力して以下の textarea に出力" onClick="medicineinfo_part01_dat_create()">
</div>
<br>

<textarea id="medicineinfo_part01" cols="100" rows="10"></textarea>
<div id="medicineinfo_part01_textlen">テスト</div>
-->

<h3 id="csv_check_result">3-1-2. 入力されたデータのチェック結果</h3>

<br>
<textarea id="csv_check_result_textarea" cols="100" rows="10"></textarea>
<br>

<p id="csv_check_result_okcnt_ngcnt"></p>

<h2 id="csvtextdata_concatted">3-2. 処方医師名・薬の名前や量・服用タイミングに関する情報</h2>
<div>
<input type="button" value="3-2 (Type01). 処方医師名・薬の名前や量・服用タイミングに関する情報を csv に変換して以下の textarea に出力" onClick="medicineinfo_part02_type01_dat_create()">
</div>

<br>
<textarea id="textarea_medicineinfo_part02_type01" cols="100" rows="10"></textarea>
<br>

<div>
  <input type="button" value="3-2 (Type03). 処方医師名・薬の名前や量・服用タイミングに関する情報を csv に変換して以下の textarea に出力" onClick="medicineinfo_part02_type03_dat_create()">
  </div>
  
  <br>
  <textarea id="textarea_medicineinfo_part02_type03" cols="100" rows="10"></textarea>
  <br>
  


<div id="navigator_linf_for_creating_divied_qr_code">
  <ul>
    <li>
      <a href="#qr_code_qrdevide_type01_setting_for_creating">「4-0. 分割 QR コード作成事前設定 (QR コード タイプ1: 911による分割あり、分割QR機能による分割なし) (QR コード タイプ2: 911による分割なし、分割QR機能による分割あり) </a>」へ、ジャンプ
    </li>
    <li>
      <a href="#create_qr_code_type01">「4-1. 1 つの CSV へ結合・CSV分割・分割CSVを基にしたQRコード作成 (QR コード タイプ01 (911 を利用した分割) 作成の開始)</a>」へ、ジャンプ
    </li>
    <li>
      <a href="#create_qr_code_type02">「4-2. 1 つの CSV へ結合・CSV分割・分割CSVを基にしたQRコード作成 (QR コード タイプ2: 911による分割なし、分割QR機能による分割あり)  作成の開始) </a>」へ、ジャンプ
    </li>
  </ul>
</div>


<div id="navigator_linf_for_creating_divied_qr_code"></div>
<br>

<h2 id="qr_code_qrdevide_type01_setting_for_creating">4-0. 分割 QR コード作成事前設定 (QR コード タイプ1: 911による分割あり、分割QR機能による分割なし) (QR コード タイプ2: 911による分割なし、分割QR機能による分割あり)
</h2>

<p>分割関連の設定</p>
<table border="1" cellspacing="0">
<tr><td>1</td><td>分割CSV作成時に、1つの CSV ファイル内の最大文字数 (※1、※2)<br>
<ul style="list-style: none;">
<li>※1. utf16 での文字数です。</li>
<li>※2. 最大文字数を数える際は、バージョンレコード(例、「JAHISTC07,2」) を含めないで数えます。</li>
<li>※3. 最大文字数には、分割制御レコード (例、「911,12345678901234,13,1」を含めます。</li>
<li>※4. 180 から 240 までの数値を指定します。
  <p>(補足) </p>
  <ol>
    <li>1 つの QR コードあたり 300 バイト以下となるように、数値を約 180 から約 240 までの間で調節してください。</li>
    <li>1 つの QR コードあたり 300 バイトを大きく超過する場合は、Kakari など一部のお薬手帳で当該の QR コードを
      読み取ろうとしてもカメラが QR コード読み取りを完了しない現象が発生する場合があります。</li>
    <li>一連の分割 QR コードの個数は 11 個以内に抑えるように (つまり、CSV データのデータ容量が大きくなりすぎないように) 
      することが強く推奨されます。
      <ol>
        <li>当アプリで表示した 12 個以上の一連の QR コード (QR コードその1とする) をいわゆる docomo 系の
          お薬手帳アプリ (例、eお薬手帳) で読み取り、その後に同お薬手帳アプリで QR コード (QR コードその2とする) を表示し、
          さらに別のお薬手帳アプリ (K群お薬手帳、F群お薬手帳) で QR コードその2を読み取ろうとしても、
          11 個目 QR コード読み取り後に (まだ 12 個目以降の QR コードを読み込みしていないにもかかわらず) 
          複数の一連の QR コード読み取りを完了したものと誤認する現象が発生する場合があります。</li>
        <li>当アプリで表示した 12 個以上の一連の QR コード (QR コードその1とする) は、
          一部のお薬手帳アプリで QR コードをカメラで撮影して読み取ろうとしても応答がなかったり、
          あるいは「不正な QR コードです」と表示される場合があります。
            <p>緩和策として、当アプリで表示した QR コードを当該のお薬手帳アプリで直接読み取る代わりに、
              いったん docomo 系お薬手帳アプリで読み取り、読み取り後に 
              docomo 系お薬手帳アプリで改めて QR コード (QR コードその2) を表示して、
              その QR コードその2を当該お薬手帳アプリで読み取ると、正常に読み取れる場合があります。
              なお、QR コードその2を表示して、QR コードその2のコード数が11個以内に収まるようにする必要があります。
            </p>
          </li>
      </ol>
    </li>
  </ol>
</li>
</ul>
<td><td><input id="max_utf16_char_val_inputted" type="text" value="220"></td></tr>
<tr><td>2</td><td>分割QRコード作成時に、1つの QR コードに含める文字の最大バイト数 (※1、※2)<br>
<ul style="list-style: none;">
<li>※1. Shift-JIS での文字数です。</li>
<li>※2. 最大文字数を数える際は、バージョンレコード(例、「JAHISTC07,2」) を含めないで数えます。</li>
<li>※3. 最大文字数には、分割制御レコード (例、「911,12345678901234,13,1」</li>
</ul>
<td><td><input id="max_sjis_char_val_inputted" type="text" value="220"></td></tr>
<tr><td>3</td><td>連結QRコード作成時に、連結データ先頭部にヘッダを付与するか <br>
  <p>電子お薬手帳アプリで QR コードを読み込ませる場合は、通常はヘッダを付与する必要があります。</p>
<ul style="list-style: none;">
<li>0...付与する (通常はこちらを選んでください)</li>
<li>1...付与しない (デバッグ、障害調査、原因切り分けなどの際に利用します。)</li>
</ul>
<td><td><input id="addQrHeader" type="text" value="0"></td></tr>
</table>


<br>
<h3 id="create_qr_code_type01">4-1. 1 つの CSV へ結合・CSV分割・分割CSVを基にしたQRコード作成 (QR コード タイプ01 (911 を利用した分割) 作成の開始)</h3>

<div>
<input type="button" value="「4-1. QR コード タイプ01 (911 を利用した分割) 作成」の開始" onClick="medicineinfo_concat_proc()">
</div>

<p><div id="concatcsv_genqr_proc_status"></div></p>

<textarea id="medicineinfo_type01_concatted" cols="100" rows="10"></textarea>

<ul>
<li>
  <a href="#qr_code_type01">「5-1. 分割 QR コード出力結果 (QR コード タイプ1: 911による分割あり、分割QR機能による分割なし)」へ、ページ内ジャンプ</a>
</li>
</ul>

<h3 id="create_qr_code_type02">4-2. 1 つの CSV へ結合・CSV分割・分割CSVを基にしたQRコード作成 (QR コード タイプ01 (911 を利用した分割) 作成の開始)</h3>

<div>
<input type="button" value="4-2. 分割 OR コードを生成" onClick="medicineinfo_div_qr_create_test02()">
</div>

<p><div id="concatcsv_genqr_proc_status2"></div></p>

<textarea id="sjis_slice_text_data" cols="100" rows="10"></textarea>

<ul>
<li>
  <a href="#qr_code_type02">「5-2. 分割 QR コード出力結果 (QR コード タイプ2: 911による分割なし、分割QR機能による分割あり)」へ、ページ内ジャンプ</a>
</li>
</ul>
<textarea id="medicineinfo_type02_concatted" cols="100" rows="10"></textarea>

<h3 id="create_qr_code_type03">4-3. 1 つの CSV へ結合・CSV分割・分割CSVを基にしたQRコード作成 (マツモトキヨシお薬手帳専用) (QR コード タイプ01 (911 を利用した分割) 作成の開始)</h3>
<div>
  <input type="button" value="4-3. 分割 OR コードを生成" onClick="medicineinfo_concat_qrcode_create_type03()">
</div>

<p><div id="concatcsv_genqr_proc_status03"></div></p>

<textarea id="medicineinfo_type03_concatted" cols="100" rows="10"></textarea>

<ul>
  <li>
    <a href="#qr_code_type03">「5-3. 分割 QR コード出力結果 (QR コード タイプ2: 911による分割あり (ただし 911 レコードは、なし)、分割QR機能による分割あり)」へ、ページ内ジャンプ</a>
  </li>
  </ul>
  
<script>
function addText (event) {
    var  targ = event.target || event.srcElement;
    document.getElementById("alltext").value += targ.textContent || targ.innerText;
}
</script>

<h3 id="qr_code_type01">5-1. 分割 QR コード出力結果 (QR コード タイプ1: 911による分割あり、分割QR機能による分割なし)</h3>
<p id="lastoutput01"></p>
<p id="div_qr_output_area01"></p>

<p>(ここでは便宜上タイプ1と呼ぶ (タイプ1 は、JAHIS の定義書で定義されている正式な名称ではなく、このページで便宜上利用している表現となる。) </p>
<p>参考: <a href="https://www.nichiyaku.or.jp/e_kusulink/list.html">e薬LINKに対応している電子お薬手帳 (一覧) の表</a></a>を基にして、「タイプ1: 922による分割あり、分割QR機能による分割なしの QR コード読み取りの可否」の情報を追記したもの</p>

<h3 id="qr_code_type02">5-2. 分割 QR コード出力結果 (QR コード タイプ2: 911による分割なし、分割QR機能による分割あり)</h3>
<p id="div_qr_output_area02"></p>

<p>(ここでは便宜上タイプ2と呼ぶ (タイプ1 は、JAHIS の定義書で定義されている正式な名称ではなく、このページで便宜上利用している表現となる。) </p>

<h3 id="qr_code_type03">5-3. 分割 QR コード出力結果 (QR コード タイプ2: 911による分割あり (ただし 911 レコードは、なし)、分割QR機能による分割あり)</h3>
<p id="lastoutput03"></p>
<p id="div_qr_output_area03"></p>

<!--
<p>テスト用 (lastoutput02)</p>
<p id="lastoutput02"></p>

<p>テスト用</p>
<textarea id="alltext"></textarea>

<ol onclick="addText(event)">
  <li>Hello</li>
  <li>World</li>
  <li>Earthlings</li>
</ol>
-->


<script>
function buttonClick(){
//  msg.innerText = reviewTextarea.value;
  var varec_arr = [];
  varec_arr.push(document.getElementById('verec_verinfo').value);
  varec_arr.push(document.getElementById('verrec_outputtype').value);
  var varec_str = varec_arr.join(',');
  
  document.getElementById('verec_verinfo').value = varec_str;

//  document.getElementById('csv_utf8_output').value = varec_str;
  document.getElementById('csv_utf8_output').value = "あいうえお";
//  csv_utf8_putput.innerText = "テスト";
}

</script>

<p>QR コードは以上で終了です。</p>

<!--
<div>
<input type="button" value="Check" onClick="buttonClick()">
</div>

<textarea id="csv_utf8_output" cols="100" rows="20">
</textarea>
-->







<script language="javascript" type="text/javascript">
    function coladd() {
        var table = document.getElementById("table");
        // 行を行末に追加
        var row = table.insertRow(-1);
        //td分追加
        var cell1 = row.insertCell(-1);
        var cell2 = row.insertCell(-1);
        // セルの内容入力
        cell1.innerHTML = '行を追加しました';
        cell2.innerHTML = 'この行を削除しますか？<input type="button" value=削除" id="coladd" onclick="coldel(this)">';
    }
    function coldel(obj) {
        // 削除ボタンを押下された行を取得
        tr = obj.parentNode.parentNode;
        // trのインデックスを取得して行を削除する
        tr.parentNode.deleteRow(tr.sectionRowIndex);
    }
</script>





<!--
<textarea id="input_message" cols="100" rows="10" value="" onchange="func1()">
</textarea>
-->

  <div id="output_message"></div>
  <div id="img-qr"></div>
  <div id="qrinfo"></div>

  <script language="javascript" type="text/javascript">
  function func1() {
    var input_message = document.getElementById("input_message").value;
      document.getElementById("output_message").innerHTML = input_message.replace(/\n/g, "<br>\n");
//      var qrtext = input_message.replace(/\n/g, '\r\n') + String.fromCodePoint(0x1A);
      var qrtext = input_message.replace(/\n/g, '\r\n');
//      console.log(qrtext);
      var utf8qrtext = unescape(encodeURIComponent(qrtext));
      const unicodeArray = Encoding.stringToCode(qrtext); // 文字列から文字コード値の配列に変換
//      console.log(unicodeArray);
      sjisArray = [] ;
      var sjisArray = Encoding.convert(unicodeArray, {
        to: 'SJIS', 
        from: 'UNICODE' 
      });
//      console.log(sjisArray);
      const sjisStr = Encoding.codeToString(sjisArray)
//      console.log(sjisStr);

      document.getElementById("qrinfo").innerHTML = input_message.length;
//    console.log(String.fromCodePoint(0x1A)); // => "EOF"
      $("#img-qr").html("");
//      $("#img-qr").qrcode({width:200,height:200,text:utf8qrtext}); 
      $("#img-qr").qrcode({width:300,height:300,text:sjisStr}); 
  }

// https://pisuke-code.com/javascript-imple-htmlspecialchars/
	function htmlspecialchars(unsafeText){
  if(typeof unsafeText !== 'string'){
    return unsafeText;
  }
  return unsafeText.replace(
    /[&'`"<>]/g, 
    function(match) {
      return {
        '&': '&amp;',
        "'": '&#x27;',
        '`': '&#x60;',
        '"': '&quot;',
        '<': '&lt;',
        '>': '&gt;',
      }[match]
    }
  );
}
</script>




</body>
</html>
